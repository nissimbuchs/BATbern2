# Story 1.15a.4: Content API Consolidation

## Status
Approved

## Story

**As an** attendee,
**I want** consolidated Content APIs with rich discovery and filtering,
**so that** I can find and access event content efficiently.

## Domain Context

### Primary Domain
Attendee Experience Domain - Content discovery, downloads, recommendations, historical archive

### Involved Services
- Attendee Experience Service (primary)
- API Gateway (routing, middleware)
- Shared Kernel (query utilities from Story 1.15a)
- S3 (content storage)
- ElastiCache (search caching)

### Cross-Domain Dependencies
- **Depends on**: Story 1.15a (API Consolidation Foundation)
- **Depends on**: Story 1.15a.1 (Events API) for event content
- **Integrates with**: Speaker Coordination Service for speaker content

## Requirements Context

### Related Functional Requirements
- **FR23**: Content discovery and search
- **FR24**: Historical archive (20+ years)
- **FR25**: Personalized recommendations

### Acceptance Criteria Source
API Consolidation Analysis (docs/api-consolidation-analysis.md), Section 3.4 - Content Domain

## Architecture Context

### Architecture Patterns
[Source: docs/api-consolidation-analysis.md]
- **Before**: 63 content endpoints + 11 archive endpoints = 74 total
- **After**: 19 consolidated endpoints
- **Reduction**: 74%
- **Faceted Search**: `?facets=year,speaker,topic,format`
- **Recommendations**: ML-based content suggestions
- **Historical Archive**: 20+ years of BATbern content (moved from Story 1.15a.11)
- **Hall of Fame**: Curated speaker and topic statistics

## Wireframe Context

### Wireframe References
- `story-5.2-personal-dashboard.md`
- `story-5.3-content-library.md`
- `story-1.18-historical-archive.md`

## Acceptance Criteria

1. **Search Content**: `GET /api/v1/content?filter={}&sort={}&page={}&facets=year,speaker,topic`
2. **Get Content**: `GET /api/v1/content/{id}?include=analytics,reviews,versions,related`
3. **Content CRUD**: POST/PUT/PATCH/DELETE `/api/v1/content`
4. **Download**: `GET /api/v1/content/{id}/download`
5. **Preview**: `GET /api/v1/content/{id}/preview`
6. **Versions**: GET/POST `/api/v1/content/{id}/versions`
7. **Reviews**: `POST /api/v1/content/{id}/reviews`
8. **Analytics**: `GET /api/v1/content/{id}/analytics?metrics=views,downloads`
9. **Bulk Upload**: `POST /api/v1/content/bulk`
10. **Recommendations**: `GET /api/v1/content/recommendations?userId={}`
11. **Discovery**: `GET /api/v1/content/discovery?context=trending|popular|recent`
12. **Archive Events**: `GET /api/v1/archive/events?year={}&page={}`
13. **Archive Search**: `GET /api/v1/archive/search?query={}&year={}&speaker={}`
14. **Hall of Fame**: `GET /api/v1/archive/speakers/hall-of-fame`
15. **Topic Statistics**: `GET /api/v1/archive/topics/statistics?timeframe={}`

## Consolidated Endpoints (19 Total)

```
# Content Management
GET    /api/v1/content?filter={}&sort={}&page={}&facets={}
GET    /api/v1/content/{id}?include=analytics,reviews,versions,related
POST   /api/v1/content
PUT    /api/v1/content/{id}
PATCH  /api/v1/content/{id}
DELETE /api/v1/content/{id}

# Content Access
GET    /api/v1/content/{id}/download
GET    /api/v1/content/{id}/preview

# Content Versions
GET    /api/v1/content/{id}/versions?page={}
POST   /api/v1/content/{id}/versions

# Content Reviews & Analytics
POST   /api/v1/content/{id}/reviews
GET    /api/v1/content/{id}/analytics?metrics={}

# Content Discovery
POST   /api/v1/content/bulk
GET    /api/v1/content/recommendations?userId={}
GET    /api/v1/content/discovery?context={}

# Historical Archive (moved from Story 1.15a.11)
GET    /api/v1/archive/events?year={}&page={}
GET    /api/v1/archive/search?query={}&year={}&speaker={}
GET    /api/v1/archive/speakers/hall-of-fame
GET    /api/v1/archive/topics/statistics?timeframe={}
```

## Performance Requirements

- Content search with facets: <500ms (P95)
- Content detail: <200ms (P95)
- Download generation: <1s (P95)
- Archive event search: <600ms (P95)
- Archive full-text search: <700ms (P95)
- Hall of fame query: <400ms (P95)
- Topic statistics: <500ms (P95)

## Definition of Done

- [ ] All 15 ACs implemented (includes archive endpoints)
- [ ] 74 → 19 endpoints consolidation verified
- [ ] 3 wireframes migrated
- [ ] Faceted search operational
- [ ] Archive event browsing by year working
- [ ] Archive full-text search across 20+ years
- [ ] Hall of fame speaker rankings
- [ ] Topic statistics and trends
- [ ] Tests >90% coverage

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-12 | 2.0 | Added Historical Archive endpoints (4 endpoints) from Story 1.15a.11; updated totals to 74→19 | Winston (Architect) |
| 2024-10-04 | 1.0 | Initial draft for content API consolidation | Winston (Architect) |
