# Story 1.26: Notifications API Consolidation

## Status
Draft

## Story

**As a** user,
**I want** consolidated Notification APIs with preferences and delivery tracking,
**so that** I can manage how and when I receive notifications.

## Domain Context

### Primary Domain
Shared Infrastructure & Core Services - Notification management

### Involved Services
- Notification Service (primary)
- API Gateway (routing, middleware)
- Shared Kernel (query utilities from Story 1.16)
- AWS SES (email delivery)
- AWS SNS (push notifications)

### Cross-Domain Dependencies
- **Depends on**: Story 1.16 (API Consolidation Foundation)
- **Integrates with**: All services for notification triggering
- **Publishes Events**: NotificationSentEvent, NotificationReadEvent

## Requirements Context

### Related Functional Requirements
- **FR13**: Notification system with templates
- **FR22**: Email notification preferences
- **NFR-Reliability**: Notification delivery tracking

### Acceptance Criteria Source
API Consolidation Analysis (docs/api-consolidation-analysis.md), Phase 3 - Notifications Domain

## Architecture Context

### Architecture Patterns
[Source: docs/api-consolidation-analysis.md]
- **Before**: 11 endpoints
- **After**: 6 endpoints
- **Reduction**: 45%
- **Preference Management**: Granular notification settings
- **Delivery Tracking**: Status and history

## Wireframe Context

### Wireframe References
- User notification preferences screens
- In-app notification center

## Acceptance Criteria

1. **List Notifications**: `GET /api/v1/notifications?filter={}&status=unread|read|all&page={}`
2. **Mark as Read**: PUT `/api/v1/notifications/read` (bulk or single)
3. **Notification Preferences**: GET/PUT `/api/v1/notifications/preferences`
4. **Delivery History**: `GET /api/v1/notifications/history?timeframe={}&channel=email|sms|push`
5. **Delete Notifications**: DELETE `/api/v1/notifications/{id}` or batch delete
6. **Notification Count**: `GET /api/v1/notifications/count?status=unread`

## Consolidated Endpoints (6 Total)

```
# Notification Management
GET    /api/v1/notifications?filter={}&status={}&page={}
GET    /api/v1/notifications/count?status={}
PUT    /api/v1/notifications/read
DELETE /api/v1/notifications/{id}
DELETE /api/v1/notifications

# Preferences & History
GET    /api/v1/notifications/preferences
PUT    /api/v1/notifications/preferences

GET    /api/v1/notifications/history?timeframe={}&channel={}
```

## Performance Requirements

- Notification list: <200ms (P95)
- Mark as read: <100ms (P95)
- Preferences update: <150ms (P95)

## Definition of Done

- [ ] All 6 ACs implemented
- [ ] 11 â†’ 6 endpoints consolidation verified
- [ ] Granular preference management
- [ ] Bulk operations for read/delete
- [ ] Delivery tracking
- [ ] Tests >90% coverage

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-10-04 | 1.0 | Notifications API consolidation (Phase 3) | Winston (Architect) |
