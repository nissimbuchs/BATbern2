# Story 1.15a.6: Companies API Consolidation

## Status
Draft

## Story

**As a** user,
**I want** consolidated Company APIs with search and verification capabilities,
**so that** I can find and manage company affiliations efficiently.

## Domain Context

### Primary Domain
Shared Infrastructure & Core Services - Company Management

### Involved Services
- Company Management Service (primary)
- API Gateway (routing, middleware)
- Shared Kernel (query utilities from Story 1.15a)
- ElastiCache Redis (company search caching)
- S3 (logo storage)
- AWS Business Registry (Swiss UID validation)

### Cross-Domain Dependencies
- **Depends on**: Story 1.15a (API Consolidation Foundation)
- **Depends on**: Story 1.14 (Company Management Service Foundation) - if implemented
- **Integrates with**: Partner Analytics Service for partner companies
- **Integrates with**: Speaker Coordination Service for speaker companies

## Requirements Context

### Related Functional Requirements
- **FR1**: Role-based authentication with company affiliations
- **FR4**: Partner companies with enhanced privileges
- **NFR-Data Quality**: Swiss company UID validation

### Acceptance Criteria Source
API Consolidation Analysis (docs/api-consolidation-analysis.md), Phase 3 - Companies Domain

## Architecture Context

### Architecture Patterns
[Source: docs/api-consolidation-analysis.md]
- **Before**: 42 endpoints
- **After**: 10 endpoints
- **Reduction**: 76%
- **Search Optimization**: Redis caching with autocomplete
- **Verification**: Swiss UID validation integration

## Wireframe Context

### Wireframe References
- `story-1.14-company-management-screen.md` - Company CRUD
- Company autocomplete in various registration forms

## Acceptance Criteria

1. **List Companies**: `GET /api/v1/companies?filter={}&sort={}&page={}`
2. **Search/Autocomplete**: `GET /api/v1/companies/search?query={}&limit=20` with Redis caching
3. **Get Company**: `GET /api/v1/companies/{id}?include=employees,statistics,logo`
4. **Company CRUD**: POST/PUT/PATCH/DELETE `/api/v1/companies`
5. **Swiss UID Validation**: `GET /api/v1/companies/validate-uid?uid={}`
6. **Logo Upload**: POST `/api/v1/companies/{id}/logo` with presigned S3 URL
7. **Employee Relationships**: GET/POST/DELETE `/api/v1/companies/{id}/employees`
8. **Partner Promotion**: `POST /api/v1/companies/{id}/promote-partner`
9. **Verification Workflow**: `POST /api/v1/companies/{id}/verify`
10. **Company Statistics**: `GET /api/v1/companies/{id}/statistics`

## Consolidated Endpoints (10 Total)

```
GET    /api/v1/companies?filter={}&sort={}&page={}
GET    /api/v1/companies/search?query={}&limit={}
GET    /api/v1/companies/{id}?include=employees,statistics,logo
POST   /api/v1/companies
PUT    /api/v1/companies/{id}
PATCH  /api/v1/companies/{id}
DELETE /api/v1/companies/{id}

GET    /api/v1/companies/validate-uid?uid={}
POST   /api/v1/companies/{id}/logo
GET    /api/v1/companies/{id}/employees
POST   /api/v1/companies/{id}/employees
DELETE /api/v1/companies/{id}/employees/{userId}

POST   /api/v1/companies/{id}/promote-partner
POST   /api/v1/companies/{id}/verify
GET    /api/v1/companies/{id}/statistics
```

## Performance Requirements

- Company search/autocomplete: <100ms (P95) with cache
- Company detail: <200ms (P95)
- UID validation: <500ms (P95)

## Definition of Done

- [ ] All 10 ACs implemented
- [ ] 42 â†’ 10 endpoints consolidation verified
- [ ] Swiss UID validation working
- [ ] Redis search caching operational
- [ ] Logo upload with S3 presigned URLs
- [ ] Tests >90% coverage

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-10-04 | 1.0 | Companies API consolidation (Phase 3) | Winston (Architect) |
