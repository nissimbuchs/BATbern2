# Story 1.17: React Frontend Foundation with Role-Adaptive Architecture

<!-- Powered by BMAD™ Core -->

## Status

In Progress

## Story

**As a** user of any role (Organizer, Speaker, Partner, or Attendee),
**I want** to access a modern, responsive web application that adapts to my specific role and responsibilities,
**so that** I can efficiently perform my tasks without unnecessary complexity.

## Domain Context

### Primary Domain
**Shared Infrastructure & Core Services** - This story establishes the foundational frontend infrastructure that all domain-specific portals will build upon.

### Involved Services
- **API Gateway**: All frontend API calls route through API Gateway with JWT authentication
- **AWS Cognito**: User authentication and role-based access control
- **Web Frontend**: React 18.2+ application with role-adaptive architecture (NEW - created in this story)

### Cross-Domain Dependencies
- **Authentication Integration**: Depends on Story 1.2 (API Gateway & Authentication Service) for JWT token validation and user session management
- **Error Handling**: Depends on Story 1.9 (Error Handling Essentials) for standardized error responses and correlation IDs
- **Infrastructure**: Depends on Story 1.3 (Multi-Environment CDK Infrastructure) for deployment target environments
- **Future Domain Integrations**: This foundation enables future stories:
  - Story 1.14 (Company Management UI)
  - Story 1.16 (Event Management UI)
  - Story 1.18 (Event Display & Archive)
  - Story 1.19 (Speaker Portal)
  - Story 1.20 (Role Management UI)

## Requirements Context

### Related Functional Requirements
- **FR1**: Role-based authentication with distinct interfaces for organizers, speakers, partners, and attendees [Source: docs/prd-enhanced.md]
- **NFR1**: Responsive design optimized for mobile, tablet, and desktop access
- **NFR4**: Multi-language content support (German, English) with internationalization framework

### Workflow Steps
Not applicable - This story creates frontend infrastructure and does not directly implement event workflow steps.

### Acceptance Criteria Source
**Epic 1, Story 1.17** (docs/prd/epic-1-foundation-stories.md, lines 1149-1243)
- Acceptance Criteria 1-4: Role-Adaptive Component Architecture
- Acceptance Criteria 5-8: Frontend Infrastructure
- Acceptance Criteria 9-12: User Experience Foundation
- Acceptance Criteria 13-16: Development Infrastructure

## Architecture Context

### Architecture Patterns

**Frontend Architecture** [Source: docs/architecture/05-frontend-architecture.md]

1. **Component Organization Pattern**:
   - Role-adaptive components using `UserRole` enum
   - Shared component library (`components/shared/`)
   - Role-specific components (`components/organizer/`, `components/speaker/`, etc.)
   - Base layout component with role-based navigation rendering

2. **State Management Pattern**:
   - **Zustand** for client state (UI state, preferences, local data)
   - **React Query** for server state (API data, caching, background updates)
   - Authentication context from AWS Cognito integration

3. **Routing Pattern**:
   - React Router v6 with role-based route protection
   - Route guards validate user role before rendering
   - Redirect unauthorized access to appropriate dashboard

4. **Internationalization Pattern**:
   - **Library**: react-i18next with i18next-browser-languagedetector
   - **Supported Languages**: German (de-CH) as primary, English (en-US) as secondary
   - **Translation Namespaces**: `common`, `auth`, `validation`, role-specific namespaces (`organizer`, `speaker`, `partner`, `attendee`)
   - **Detection Priority**: User Profile → LocalStorage → Browser Language → Default (German)
   - **Type Safety**: Auto-generated TypeScript types from translation JSON files

**API Design Integration** [Source: docs/architecture/04-api-design.md]

1. **Authentication Pattern**:
   - AWS Cognito JWT tokens in `Authorization: Bearer {token}` header
   - Automatic token refresh using refresh token
   - Global axios interceptor for adding auth headers

2. **API Client Pattern**:
   - Type-safe API client using generated types from OpenAPI specs
   - Base URL from environment variables (`VITE_API_BASE_URL`)
   - Request/response interceptors for error handling and logging

3. **Error Handling Pattern**:
   - Global error boundary for React component errors
   - API error interceptor maps HTTP status codes to user-friendly messages
   - Correlation IDs from `X-Correlation-ID` header for debugging

### Infrastructure Components

**Deployment Infrastructure** [Source: docs/architecture/02-infrastructure-deployment.md]

1. **AWS S3 + CloudFront**:
   - S3 bucket: Static asset hosting for React build artifacts
   - CloudFront CDN: Global content delivery with edge caching
   - Domain: `https://batbern.ch` (production), `https://dev.batbern.ch` (development)

2. **Build & Deployment**:
   - Vite 5.0+ build tool for optimized bundling
   - CDK stack: `FrontendStack` (infrastructure/lib/frontend-stack.ts)
   - CI/CD: GitHub Actions workflow deploys to S3 and invalidates CloudFront cache

3. **Environment Configuration**:
   - `.env.development` - Local development environment
   - `.env.staging` - Staging environment (dev.batbern.ch)
   - `.env.production` - Production environment (batbern.ch)
   - Variables: `VITE_API_BASE_URL`, `VITE_COGNITO_USER_POOL_ID`, `VITE_COGNITO_CLIENT_ID`

**Database**: Not applicable (frontend consumes APIs only)

**EventBridge**: Not applicable (frontend does not publish domain events)

**ElastiCache**: Not applicable (server-side caching only)

## Wireframe Context

### Wireframe References

**Main Navigation Bar/Menu** [Source: docs/wireframes/story-1.17-main-navigation.md]

This wireframe defines the global navigation system that adapts to each user role:

- **Desktop Navigation**: Horizontal top navigation with role-specific menu items
- **Mobile Navigation**: Hamburger menu (☰) with slide-in overlay for screens < 768px
- **User Menu**: Dropdown with profile, settings, notifications, help, language switcher, logout
- **Notification Bell**: Manual reload dropdown showing unread count badge (no real-time updates)
- **Breadcrumbs**: Contextual navigation trail (required for organizer, optional for other roles)

**Role-Specific Navigation Items**:
- **Organizer**: Events, Topics, Speakers, Partners, Analytics
- **Speaker**: Dashboard, Materials, Profile, Community, Communications
- **Partner**: Analytics, Voting, Meetings, Settings
- **Attendee**: Events, Content, Learning, Profile

**Internationalization**: Navigation labels fully translated (German/English) using react-i18next

### UI Components

**Key Components to Implement**:

1. **BaseLayout Component** (`components/shared/Layout/BaseLayout.tsx`):
   - Props: `children`, `currentRole`, `user`, `notifications`
   - Renders: AppHeader, Sidebar (optional), MainContent area
   - Material-UI: `Box`, `Container`

2. **AppHeader Component** (`components/shared/Navigation/AppHeader.tsx`):
   - Props: `user`, `currentRole`, `notifications`
   - Renders: Logo, Navigation Menu, Notification Bell, User Avatar Dropdown, Help Icon
   - Material-UI: `AppBar`, `Toolbar`, `IconButton`, `Badge`, `Menu`, `MenuItem`

3. **NavigationMenu Component** (`components/shared/Navigation/NavigationMenu.tsx`):
   - Props: `currentRole`, `activePath`
   - Renders: Role-adaptive horizontal menu (desktop) or hamburger drawer (mobile)
   - Material-UI: `Tabs`, `Tab`, `Drawer` (mobile)
   - Configuration: Static `navigationConfig: Record<UserRole, NavigationItem[]>`

4. **NotificationDropdown Component** (`components/shared/Notifications/NotificationDropdown.tsx`):
   - Props: `notifications`, `onMarkAsRead`, `onReload`
   - Renders: Notification list with manual reload button
   - Material-UI: `Menu`, `List`, `ListItem`, `Button`
   - API: `GET /api/v1/notifications?status=unread&limit=10`

5. **UserMenuDropdown Component** (`components/shared/Navigation/UserMenuDropdown.tsx`):
   - Props: `user`, `onLogout`, `onLanguageChange`
   - Renders: User profile, settings link, help link, language switcher, logout
   - Material-UI: `Menu`, `MenuItem`, `Divider`, `Select`

6. **LanguageSwitcher Component** (`components/shared/LanguageSwitcher/LanguageSwitcher.tsx`):
   - Props: None (uses Zustand store and react-i18next)
   - Renders: Language dropdown (🇨🇭 Deutsch / 🇬🇧 English)
   - Material-UI: `Select`, `MenuItem`
   - API: `PUT /api/v1/users/me/preferences` (partial update with `language` field)

7. **ErrorBoundary Component** (`components/shared/ErrorBoundary/ErrorBoundary.tsx`):
   - Props: `children`, `fallback`
   - Handles: Component-level errors with fallback UI
   - Material-UI: `Alert`, `Button` (retry action)

## Acceptance Criteria

### Role-Adaptive Component Architecture

1. **Base Layout Component**: Implement role-adaptive navigation and layout system
2. **Role-Based Routing**: Configure React Router with role-based route protection
3. **Adaptive Navigation**: Navigation menus that adapt based on authenticated user role
4. **Component Library**: Establish shared component library with consistent design patterns

### Frontend Infrastructure

5. **Authentication Integration**: AWS Cognito integration with automatic token refresh
6. **API Client Layer**: Implement type-safe API clients for all microservices
7. **State Management**: Configure Zustand stores for client state and React Query for server caching
8. **Error Handling**: Global error boundary system with role-appropriate error displays

### User Experience Foundation

9. **Responsive Design**: Mobile-first responsive design with breakpoint optimization
10. **Accessibility**: WCAG 2.1 Level AA compliance with screen reader support
11. **Performance**: Code splitting and lazy loading for optimal bundle sizes
12. **Progressive Web App**: Service worker implementation for offline capabilities

### Development Infrastructure

13. **TypeScript Configuration**: Strict TypeScript setup with comprehensive type safety
14. **Testing Framework**: Vitest + React Testing Library setup with component test coverage
15. **Build Optimization**: Vite configuration with proper asset optimization and caching
16. **Development Environment**: Hot module replacement and optimal developer experience

## Test Specifications (TDD)

### Test Scenarios by Acceptance Criteria

**AC1-4 Tests (Role-Adaptive Architecture):**

- Test 1.1: `should_renderOrganizerNavigation_when_userRoleIsOrganizer`
- Test 1.2: `should_renderSpeakerNavigation_when_userRoleIsSpeaker`
- Test 1.3: `should_renderPartnerNavigation_when_userRoleIsPartner`
- Test 1.4: `should_renderAttendeeNavigation_when_userRoleIsAttendee`
- Test 1.5: `should_redirectToLoginPage_when_userNotAuthenticated`
- Test 1.6: `should_redirectToDashboard_when_userAccessesUnauthorizedRoute`

**AC5-8 Tests (Frontend Infrastructure):**

- Test 5.1: `should_refreshJWTToken_when_tokenExpiresSoon`
- Test 5.2: `should_logoutUser_when_tokenRefreshFails`
- Test 6.1: `should_includeAuthHeader_when_makingAPICall`
- Test 6.2: `should_handleAPIError_when_serverReturns500`
- Test 7.1: `should_persistUIState_when_userChangesLanguage`
- Test 7.2: `should_cacheUserProfile_when_fetchedFromAPI`
- Test 8.1: `should_displayErrorBoundary_when_componentThrowsError`
- Test 8.2: `should_logErrorToSentry_when_errorBoundaryCatches`

**AC9-12 Tests (User Experience):**

- Test 9.1: `should_renderMobileNavigation_when_screenWidthBelow768px`
- Test 9.2: `should_renderDesktopNavigation_when_screenWidthAbove768px`
- Test 10.1: `should_haveKeyboardNavigation_when_userPressesTab`
- Test 10.2: `should_announceToScreenReader_when_notificationCountUpdates`
- Test 11.1: `should_loadComponentLazily_when_userNavigatesToRoute`
- Test 11.2: `should_meetCoreLCP_when_initialPageLoad` (LCP < 2.5s)
- Test 12.1: `should_registerServiceWorker_when_appLoads`
- Test 12.2: `should_cacheAssets_when_serviceWorkerInstalled`

**AC13-16 Tests (Development Infrastructure):**

- Test 13.1: `should_failTypeCheck_when_invalidPropsProvided`
- Test 13.2: `should_inferTypes_when_usingZustandStore`
- Test 14.1: `should_renderComponent_when_unitTestRuns` (vitest + RTL)
- Test 14.2: `should_haveMinimum80PercentCoverage_when_testsComplete`
- Test 15.1: `should_splitCodeByRoute_when_buildingForProduction`
- Test 15.2: `should_optimizeImages_when_buildingForProduction`
- Test 16.1: `should_hotReload_when_sourceFileChanges`

### Test File Locations

**Frontend Tests:**

- `web-frontend/src/components/shared/Layout/BaseLayout.test.tsx`
- `web-frontend/src/components/shared/Navigation/AppHeader.test.tsx`
- `web-frontend/src/components/shared/Navigation/NavigationMenu.test.tsx`
- `web-frontend/src/components/shared/Notifications/NotificationDropdown.test.tsx`
- `web-frontend/src/components/shared/Navigation/UserMenuDropdown.test.tsx`
- `web-frontend/src/components/shared/LanguageSwitcher/LanguageSwitcher.test.tsx`
- `web-frontend/src/components/shared/ErrorBoundary/ErrorBoundary.test.tsx`
- `web-frontend/src/hooks/useAuth/useAuth.test.ts`
- `web-frontend/src/hooks/useNotifications/useNotifications.test.ts`
- `web-frontend/src/services/api/apiClient.test.ts`
- `web-frontend/src/stores/authStore.test.ts`
- `web-frontend/src/stores/uiStore.test.ts`
- `web-frontend/src/i18n/config.test.ts`

**E2E Tests (Playwright):**

- `e2e/workflows/authentication/login.spec.ts`
- `e2e/workflows/navigation/role-adaptive-navigation.spec.ts`
- `e2e/workflows/notifications/notification-dropdown.spec.ts`
- `e2e/workflows/i18n/language-switching.spec.ts`

### Test Data & Mocks

**Test Data Builders:**
- `UserTestDataBuilder` for creating test users with different roles
- `NotificationTestDataBuilder` for creating test notifications
- `NavigationConfigTestData` for role-specific navigation configurations

**Mock Services:**
- Mock AWS Cognito authentication responses (JWT tokens)
- Mock API client responses (`apiClient.get`, `apiClient.post`, etc.)
- Mock react-i18next for translation tests
- Mock React Query cache for server state tests

**Test Containers:**
- Not applicable (frontend only, no backend containers needed)

## Tasks / Subtasks (TDD Workflow)

- [x] Task 1: Project Setup & Configuration (Infrastructure Foundation)
  - [x] Initialize Vite React TypeScript project in `web-frontend/` directory
  - [x] Configure `tsconfig.json` with strict TypeScript settings
  - [x] Install core dependencies (React 18.2+, Material-UI 5.14+, Zustand 4.4+, React Query 4.36+, React Router v6)
  - [x] Install dev dependencies (Vitest 1.0+, React Testing Library 13.4+, Playwright 1.40+, ESLint, Prettier)
  - [x] Configure Vite build settings (`vite.config.ts`) with code splitting and optimization
  - [x] Create environment variable files (`.env.development`, `.env.staging`, `.env.production`)
  - [x] Configure Material-UI theme with Swiss design standards
  - [x] Set up Tailwind CSS 3.3+ for utility-first styling

- [x] Task 2a: i18n Infrastructure TDD (RED Phase) (AC: 4, 9) ✅
  - [x] Write failing tests for i18n configuration and language detection
  - [x] Write failing tests for translation key type safety and namespace loading
  - [x] Write failing tests for language switcher component (German/English toggle)
  - [x] Write failing tests for date/time formatting with date-fns locales

- [x] Task 2b: i18n Infrastructure Implementation (GREEN Phase) (AC: 4, 9) ✅
  - [x] Configure react-i18next with i18next-browser-languagedetector
  - [x] Create translation JSON files in `public/locales/de/` and `public/locales/en/`
  - [x] Generate TypeScript types from translation files for type safety
  - [x] Implement language detection priority (User Profile → LocalStorage → Browser → Default)
  - [x] Create date/time formatting utils using date-fns with locale support
  - [x] Implement LanguageSwitcher component with API integration

- [x] Task 3a: Authentication Integration TDD (RED Phase) (AC: 5)
  - [x] Write failing tests for AWS Cognito JWT token storage and retrieval
  - [x] Write failing tests for automatic token refresh logic
  - [x] Write failing tests for logout and session cleanup

- [x] Task 3b: Authentication Integration Implementation (GREEN Phase) (AC: 5)
  - [x] Configure AWS Amplify for Cognito integration
  - [x] Implement `useAuth` hook with token management and auto-refresh
  - [x] Create auth context provider wrapping application root
  - [x] Implement axios interceptor for adding `Authorization: Bearer {token}` header
  - [x] Implement logout functionality with token revocation and cache clearing

- [x] Task 4a: API Client Layer TDD (RED Phase) (AC: 6)
  - [x] Write failing tests for type-safe API client methods
  - [x] Write failing tests for error handling (4xx, 5xx responses)
  - [x] Write failing tests for request/response interceptors

- [ ] Task 4b: API Client Layer Implementation (GREEN Phase) (AC: 6)
  - [x] Create base axios API client with environment-based base URL
  - [x] Implement request interceptor for auth headers and correlation IDs
  - [x] Implement response interceptor for error handling and logging
  - [ ] Generate TypeScript types from OpenAPI specifications (if available)
  - [ ] Create type-safe API client wrapper functions for common endpoints

- [x] Task 5a: State Management TDD (RED Phase) (AC: 7) ✅
  - [x] Write failing tests for Zustand auth store (user, role, login, logout actions)
  - [x] Write failing tests for Zustand UI store (locale, sidebar, notifications)
  - [x] Write failing tests for React Query user profile query and caching
  - [x] Write failing tests for React Query notifications query and manual refresh

- [x] Task 5b: State Management Implementation (GREEN Phase) (AC: 7) ✅
  - [x] Create Zustand auth store with user and role management
  - [x] Create Zustand UI store with locale and UI state
  - [x] Configure React Query provider with optimized cache settings
  - [x] Implement `useUserProfile` hook with React Query
  - [x] Implement `useNotifications` hook with React Query (manual reload only)
  - [x] Implement state persistence to localStorage for auth and UI state

- [ ] Task 6a: Role-Adaptive Navigation TDD (RED Phase) (AC: 1-3)
  - [ ] Write failing tests for BaseLayout component rendering
  - [ ] Write failing tests for AppHeader component with role-specific navigation
  - [ ] Write failing tests for NavigationMenu role adaptation (4 roles)
  - [ ] Write failing tests for mobile hamburger menu (< 768px breakpoint)

- [ ] Task 6b: Role-Adaptive Navigation Implementation (GREEN Phase) (AC: 1-3)
  - [ ] Create static `navigationConfig` in `src/config/navigationConfig.ts`
  - [ ] Implement BaseLayout component with AppHeader and MainContent
  - [ ] Implement AppHeader component with Material-UI AppBar and Toolbar
  - [ ] Implement NavigationMenu with role-based rendering
  - [ ] Implement responsive hamburger menu with slide-in drawer (mobile)
  - [ ] Implement breadcrumbs component (required for organizer)

- [ ] Task 7a: Notification System TDD (RED Phase) (AC: 4)
  - [ ] Write failing tests for NotificationDropdown rendering and manual reload
  - [ ] Write failing tests for notification mark as read action
  - [ ] Write failing tests for notification deletion

- [ ] Task 7b: Notification System Implementation (GREEN Phase) (AC: 4)
  - [ ] Implement NotificationDropdown component with manual reload button
  - [ ] Implement notification list with unread count badge
  - [ ] Implement "Mark as read" and "Mark all as read" actions with optimistic updates
  - [ ] Implement notification deletion with optimistic updates
  - [ ] Connect to `GET /api/v1/notifications?status=unread&limit=10` API

- [ ] Task 8a: User Menu & Language Switcher TDD (RED Phase) (AC: 4)
  - [ ] Write failing tests for UserMenuDropdown rendering
  - [ ] Write failing tests for language change action and API persistence
  - [ ] Write failing tests for logout action

- [ ] Task 8b: User Menu & Language Switcher Implementation (GREEN Phase) (AC: 4)
  - [ ] Implement UserMenuDropdown with profile, settings, help, logout links
  - [ ] Implement LanguageSwitcher with German/English toggle
  - [ ] Connect language switcher to `PUT /api/v1/users/me/preferences` API
  - [ ] Implement logout action with cache clearing and redirect to login

- [ ] Task 9a: Error Handling TDD (RED Phase) (AC: 8)
  - [ ] Write failing tests for ErrorBoundary catching component errors
  - [ ] Write failing tests for API error display with user-friendly messages
  - [ ] Write failing tests for correlation ID logging

- [ ] Task 9b: Error Handling Implementation (GREEN Phase) (AC: 8)
  - [ ] Implement ErrorBoundary component with fallback UI
  - [ ] Integrate Sentry for error logging (optional for MVP)
  - [ ] Implement global error toast notifications using Material-UI Snackbar
  - [ ] Map API error status codes to user-friendly messages

- [ ] Task 10a: Routing & Route Guards TDD (RED Phase) (AC: 2)
  - [ ] Write failing tests for route protection based on user role
  - [ ] Write failing tests for unauthorized redirect to dashboard
  - [ ] Write failing tests for session expired redirect to login

- [ ] Task 10b: Routing & Route Guards Implementation (GREEN Phase) (AC: 2)
  - [ ] Configure React Router v6 with route definitions
  - [x] Implement ProtectedRoute wrapper component with role validation
  - [ ] Define role-specific routes (organizer, speaker, partner, attendee dashboards)
  - [x] Implement redirect logic for unauthorized access (403 → dashboard)
  - [x] Implement redirect logic for session expired (401 → login with returnUrl)

- [ ] Task 11a: Responsive Design TDD (RED Phase) (AC: 9)
  - [ ] Write failing tests for mobile layout rendering (< 768px)
  - [ ] Write failing tests for tablet layout rendering (768px - 1024px)
  - [ ] Write failing tests for desktop layout rendering (> 1024px)

- [ ] Task 11b: Responsive Design Implementation (GREEN Phase) (AC: 9)
  - [ ] Implement mobile-first responsive breakpoints using Material-UI breakpoints
  - [ ] Test responsive navigation on mobile, tablet, and desktop
  - [ ] Implement hamburger menu slide-in animation for mobile
  - [ ] Optimize image loading with responsive image components

- [ ] Task 12a: Accessibility TDD (RED Phase) (AC: 10)
  - [ ] Write failing tests for semantic HTML structure
  - [ ] Write failing tests for keyboard navigation (Tab, Enter, Escape)
  - [ ] Write failing tests for screen reader announcements (aria-live)
  - [ ] Write failing tests for focus indicators and color contrast

- [ ] Task 12b: Accessibility Implementation (GREEN Phase) (AC: 10)
  - [ ] Add semantic HTML5 elements (`<nav>`, `<main>`, `<header>`)
  - [ ] Implement ARIA labels, roles, and attributes for all interactive elements
  - [ ] Implement keyboard navigation support (Tab, Shift+Tab, Enter, Escape)
  - [ ] Implement focus management for dropdown menus (focus trap)
  - [ ] Test with screen readers (NVDA, JAWS, VoiceOver)
  - [ ] Ensure minimum 4.5:1 color contrast for WCAG 2.1 AA compliance

- [ ] Task 13a: Performance Optimization TDD (RED Phase) (AC: 11)
  - [ ] Write failing tests for code splitting by route
  - [ ] Write failing tests for lazy loading of components
  - [ ] Write failing tests for Core Web Vitals (LCP < 2.5s, CLS < 0.1, FID < 100ms)

- [ ] Task 13b: Performance Optimization Implementation (GREEN Phase) (AC: 11)
  - [ ] Implement React.lazy() for route-level code splitting
  - [ ] Implement dynamic imports for heavy components
  - [ ] Optimize bundle size with Vite tree-shaking
  - [ ] Configure asset optimization (minification, compression)
  - [ ] Implement React.memo for frequently re-rendered components
  - [ ] Test Core Web Vitals with Lighthouse and web-vitals library

- [ ] Task 14a: PWA Support TDD (RED Phase) (AC: 12)
  - [ ] Write failing tests for service worker registration
  - [ ] Write failing tests for offline page caching

- [ ] Task 14b: PWA Support Implementation (GREEN Phase) (AC: 12)
  - [ ] Configure Vite PWA plugin with service worker
  - [ ] Implement offline page caching strategy
  - [ ] Create web app manifest (`manifest.json`) with icons and theme colors
  - [ ] Test offline functionality and service worker updates

- [ ] Task 15: Infrastructure Setup (Deployment & CDK)
  - [ ] Check CDK stack for frontend deployment (`infrastructure/lib/frontend-stack.ts`)
  - [ ] Check S3 bucket for static asset hosting with proper CORS and caching
  - [ ] Check CloudFront distribution with origin access identity
  - [ ] Check Route 53 DNS for custom domain (batbern.ch)
  - [ ] Check SSL/TLS certificate with AWS Certificate Manager

- [ ] Task 16: CI/CD Pipeline Integration
  - [ ] Check GitHub Actions workflow for frontend build and test
  - [ ] Check workflow step for running Vitest unit tests
  - [ ] Check workflow step for running Playwright E2E tests
  - [ ] Check workflow step for Vite production build
  - [ ] Check workflow step for deploying to S3 and invalidating CloudFront cache
  - [ ] Check deployment approval gates for staging and production

- [ ] Task 17: Final Refactoring & Documentation (REFACTOR)
  - [ ] Verify all unit tests pass (>80% coverage achieved)
  - [ ] Verify all E2E tests pass (authentication, navigation, i18n)
  - [ ] Refactor components for reusability and maintainability
  - [ ] Extract common hooks and utilities
  - [ ] Remove dead code and unused dependencies
  - [ ] Document component APIs with JSDoc comments
  - [ ] Create Storybook stories for shared components (optional)
  - [ ] Update README.md with development setup instructions

## Dev Notes - Implementation Guide

### Technical Design Notes

**Frontend Architecture Approach**:

This story establishes the **foundational React frontend infrastructure** using a **role-adaptive component architecture**. The key design principle is that a single React application dynamically adapts its navigation, routing, and components based on the authenticated user's role from AWS Cognito JWT tokens.

**Design Patterns to Apply**:

1. **Compound Component Pattern** for complex components like NotificationDropdown
2. **Higher-Order Component (HOC)** for route protection: `withRoleProtection(Component, allowedRoles)`
3. **Custom Hooks** for reusable logic: `useAuth`, `useNotifications`, `useUserProfile`, `useFormatDate`
4. **Provider Pattern** for global state: AuthProvider, UIProvider (using React Context + Zustand)

**Service Method Signatures** (Frontend):

```typescript
// Authentication Service
interface AuthService {
  login(email: string, password: string): Promise<User>;
  logout(): Promise<void>;
  refreshToken(): Promise<string>;
  getCurrentUser(): Promise<User | null>;
}

// API Client Service
interface APIClient {
  get<T>(url: string, config?: AxiosRequestConfig): Promise<T>;
  post<T>(url: string, data: any, config?: AxiosRequestConfig): Promise<T>;
  put<T>(url: string, data: any, config?: AxiosRequestConfig): Promise<T>;
  delete<T>(url: string, config?: AxiosRequestConfig): Promise<T>;
}
```

**Caching Strategies**:

- **React Query**: 5-minute stale time for user profile, 5-minute stale time for notifications
- **LocalStorage**: Persist auth tokens and user language preference
- **CloudFront**: CDN caching for static assets (JS, CSS, images) with 1-year cache headers

**Error Handling Patterns**:

- **Component Errors**: ErrorBoundary catches and displays fallback UI
- **API Errors**: Axios interceptor maps status codes → user-friendly toast messages
- **Network Errors**: Display offline banner if `navigator.onLine === false`

**Performance Considerations**:

- **Initial Bundle Size**: Target < 250KB gzipped
- **Route-Level Code Splitting**: Each role portal loaded lazily
- **Image Optimization**: WebP format with fallback to PNG/JPG
- **Lazy Loading**: Material-UI icons loaded on-demand

### API Contracts

**API Endpoints Used by Frontend**:

1. **GET /api/v1/users/me?include=roles,preferences** *(Story 1.23 Consolidation)*
   - **Purpose**: Fetch authenticated user profile, roles, and preferences in a single request
   - **Request Headers**: `Authorization: Bearer {JWT}`
   - **Query Parameters**:
     - `include=roles,preferences` (expands roles and preferences in response)
   - **Response Schema**:
     ```json
     {
       "userId": "uuid",
       "email": "john.doe@example.com",
       "firstName": "John",
       "lastName": "Doe",
       "currentRole": "ORGANIZER",
       "availableRoles": ["ORGANIZER", "SPEAKER"],
       "companyId": "uuid",
       "profilePhotoUrl": "https://cdn.example.com/...",
       "preferences": {
         "language": "de",
         "notifications": {
           "emailEnabled": true,
           "inAppEnabled": true
         },
         "theme": "light"
       }
     }
     ```
   - **Error Responses**:
     - 401 Unauthorized: Session expired, redirect to login
     - 404 Not Found: User deleted, force logout
   - **Validation Rules**: JWT must be valid and not expired
   - **Rate Limiting**: 100 requests per minute per user

2. **GET /api/v1/notifications?status=unread&limit=10** *(Story 1.26 Consolidation)*
   - **Purpose**: Fetch unread notifications for notification dropdown
   - **Request Headers**: `Authorization: Bearer {JWT}`
   - **Query Parameters**:
     - `status=unread` (filter for unread notifications only)
     - `limit=10` (pagination limit for dropdown)
   - **Response Schema**:
     ```json
     {
       "notifications": [
         {
           "id": "uuid",
           "type": "EVENT_STATUS_CHANGED",
           "title": "Event status changed",
           "message": "Event 'BATbern 2025' is now Published",
           "timestamp": "2024-03-15T14:30:00Z",
           "isRead": false,
           "actionUrl": "/events/uuid",
           "priority": "NORMAL"
         }
       ],
       "unreadCount": 3,
       "totalCount": 47,
       "hasMore": true
     }
     ```
   - **Error Responses**:
     - 401 Unauthorized: Session expired
     - 500 Internal Server Error: Show error icon on notification bell
   - **Rate Limiting**: 60 requests per minute per user

3. **PUT /api/v1/notifications/read** *(Story 1.26 Consolidation)*
   - **Purpose**: Mark notification(s) as read (single or bulk)
   - **Request Headers**: `Authorization: Bearer {JWT}`
   - **Request Body (Single)**:
     ```json
     {
       "notificationIds": ["uuid"]
     }
     ```
   - **Request Body (Bulk - Mark All)**:
     ```json
     {
       "markAll": true
     }
     ```
   - **Response Schema**:
     ```json
     {
       "success": true,
       "markedCount": 3,
       "updatedAt": "2024-03-15T14:35:00Z"
     }
     ```
   - **Error Responses**:
     - 400 Bad Request: Invalid notification IDs
     - 401 Unauthorized: Session expired

4. **DELETE /api/v1/notifications/{id}**
   - **Purpose**: Delete a single notification
   - **Request Headers**: `Authorization: Bearer {JWT}`
   - **Response Schema**:
     ```json
     {
       "success": true
     }
     ```
   - **Error Responses**:
     - 404 Not Found: Notification already deleted

5. **POST /api/v1/auth/logout**
   - **Purpose**: Invalidate refresh token and revoke session
   - **Request Headers**: `Authorization: Bearer {JWT}`
   - **Request Body**:
     ```json
     {
       "refreshToken": "..."
     }
     ```
   - **Response Schema**:
     ```json
     {
       "success": true
     }
     ```
   - **Side Effects**: Revoke Cognito tokens, clear session

6. **PUT /api/v1/users/me/preferences** *(Story 1.23 Consolidation)*
   - **Purpose**: Update user preferences (language, theme, notifications)
   - **Request Headers**: `Authorization: Bearer {JWT}`
   - **Request Body (Partial Update Supported)**:
     ```json
     {
       "language": "de"
     }
     ```
   - **Response Schema**:
     ```json
     {
       "success": true,
       "preferences": {
         "language": "de",
         "notifications": {
           "emailEnabled": true,
           "inAppEnabled": true
         },
         "theme": "light"
       }
     }
     ```
   - **Error Responses**:
     - 400 Bad Request: Invalid language code
     - 401 Unauthorized: Session expired

### Testing Requirements

**Unit Test Requirements and Coverage Targets**:

- **Component Tests**: 90% coverage for all UI components
- **Hook Tests**: 95% coverage for custom hooks (useAuth, useNotifications, etc.)
- **Utility Tests**: 100% coverage for pure utility functions

**Integration Test Scenarios**:

1. **Authentication Flow**: Login → Fetch user profile → Navigate to dashboard
2. **Role-Based Navigation**: Navigate to role-specific routes → Verify navigation items
3. **Notification Interaction**: Open dropdown → Mark as read → Verify badge count updates
4. **Language Switching**: Change language → Verify UI updates → Verify API call to persist preference

**E2E Test Cases (Playwright)**:

1. **Organizer Login Journey**: Login as organizer → Verify "Events" menu item → Navigate to events page
2. **Notification Flow**: Login → Open notifications → Mark all as read → Verify badge count = 0
3. **Language Switching**: Login → Change language to English → Verify navigation labels in English → Reload page → Verify persistence
4. **Logout Flow**: Login → Open user menu → Click logout → Verify redirect to login page

**Performance Test Criteria**:

- **Largest Contentful Paint (LCP)**: < 2.5s on 3G connection
- **First Input Delay (FID)**: < 100ms
- **Cumulative Layout Shift (CLS)**: < 0.1
- **Bundle Size**: < 250KB gzipped for initial load

**Test Data Requirements**:

- Mock user objects for all 4 roles (Organizer, Speaker, Partner, Attendee)
- Mock notification objects with various types and priorities
- Mock JWT tokens with different roles and expiration times

**Mock Service Configurations**:

- Mock AWS Amplify for Cognito authentication
- Mock axios for API client
- Mock React Query cache for server state
- Mock react-i18next for translation tests

## Definition of Done Checklist

### Development Complete

- [ ] All tests written BEFORE implementation (TDD followed)
- [ ] All acceptance criteria have corresponding tests
- [ ] All acceptance criteria implemented
- [ ] Unit tests written and passing (>90% coverage for business logic, >80% overall)
- [ ] Integration tests cover new functionality (>80% coverage)
- [ ] E2E tests pass for user journeys (authentication, navigation, i18n, notifications)
- [ ] Code follows project conventions (ESLint, Prettier, coding standards)
- [ ] TypeScript types properly defined (strict mode, no `any` types)
- [ ] API documentation not applicable (frontend consumes APIs only)
- [ ] Database migrations not applicable (no database)

### Infrastructure Complete ⚠️ CRITICAL

- [ ] CDK stack created for frontend deployment (`infrastructure/lib/frontend-stack.ts`)
- [ ] S3 bucket configured for static asset hosting with proper CORS and caching
- [ ] CloudFront distribution configured with origin access identity
- [ ] Route 53 DNS configured for custom domain (batbern.ch, dev.batbern.ch)
- [ ] SSL/TLS certificate configured with AWS Certificate Manager
- [ ] Deployment tested in dev, staging, and production environments
- [ ] CloudWatch alarms configured for frontend errors (4xx, 5xx rates)
- [ ] Cost analysis completed (estimated S3 + CloudFront costs < $50/month)

### Frontend Complete

- [ ] React components match wireframe designs (Main Navigation Bar)
- [ ] Responsive design tested (mobile < 768px, tablet 768px-1024px, desktop > 1024px)
- [ ] Accessibility requirements met (WCAG 2.1 AA: keyboard navigation, screen reader support, color contrast)
- [ ] Performance metrics achieved (LCP < 2.5s, FID < 100ms, CLS < 0.1, bundle < 250KB)
- [ ] Error handling and loading states implemented for all API calls
- [ ] Internationalization support added (German/English with react-i18next)

### Review Ready

- [ ] PR created with detailed description
- [ ] Code review completed by team
- [ ] Infrastructure review completed (CDK stack, S3, CloudFront configuration)
- [ ] Security review passed (no secrets in code, proper CORS, CSP headers)
- [ ] Documentation updated (README.md with development setup, component API docs)
- [ ] CLAUDE.md updated if commands changed (not applicable)
- [ ] Deployment instructions documented in docs/deployment/frontend-deployment.md

## Change Log

| Date       | Version | Description                                      | Author         |
|------------|---------|--------------------------------------------------|----------------|
| 2025-10-05 | 1.0     | Initial story creation for Epic 1, Story 1.17    | Scrum Master   |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Implementation Approach
**Status Assessment (2025-10-06):**

Much of the foundational work for Story 1.17 was already completed in previous stories (primarily Story 1.2). Upon analysis of the existing codebase:

**Completed Prior to Story 1.17:**
- ✅ Vite React TypeScript project setup with strict configuration
- ✅ Core dependencies installed (React 18.2, Material-UI 5.14, Zustand 4.4, React Query 4.36, React Router v6)
- ✅ i18n infrastructure with react-i18next (German/English support)
- ✅ AWS Amplify + Cognito authentication integration
- ✅ `useAuth` hook with token management and auto-refresh
- ✅ API client with axios interceptors (auth headers, error handling)
- ✅ `ProtectedRoute` component with role-based access control
- ✅ Login, ForgotPassword, and LanguageSwitcher components

**Remaining Work for Story 1.17 (Core Differentiators):**
- ❌ Role-adaptive navigation system (BaseLayout, AppHeader, NavigationMenu)
- ❌ Zustand state stores (authStore, uiStore)
- ❌ React Query hooks (useUserProfile, useNotifications)
- ❌ Notification system (NotificationDropdown)
- ❌ User menu integration
- ❌ Material-UI theme configuration
- ❌ Tailwind CSS setup
- ❌ Environment files (.env.development, .env.staging, .env.production)
- ❌ Full routing configuration with role-specific dashboards
- ❌ Responsive design, accessibility, performance optimizations
- ❌ PWA support
- ❌ Infrastructure (CDK Frontend Stack, CI/CD pipeline)

**Implementation Progress (2025-10-06):**

**✅ Completed Tasks:**
- Task 1: Project Setup & Configuration (8/8 subtasks complete)
  - Environment files created (.env.development, .env.staging, .env.production)
  - Material-UI Swiss design theme configured
  - Tailwind CSS 3.3+ integrated with PostCSS
- Task 2a & 2b: i18n Infrastructure (6/6 subtasks complete)
  - date-fns locales added with full test coverage (16 tests passing)
  - Date formatting utilities: formatDate, formatTime, formatDateTime, formatRelativeTime, parseDate
- Tasks 3a & 3b: Authentication (already complete from Story 1.2)
- Task 4a & partially 4b: API Client (already complete from Story 1.2)
- Task 5a & 5b: State Management (12/12 subtasks complete)
  - Zustand auth store with persist middleware (11 tests passing)
  - Zustand UI store with localStorage integration (13 tests passing)
  - React Query `useUserProfile` hook with 5-minute stale time (7 tests passing)
  - React Query `useNotifications` hook with mutations (9 tests passing)
  - State persistence to localStorage for auth user and UI preferences
  - Total tests: 157 passing (including all previous tests)

**📋 Remaining Work:**
- Task 6: Role-Adaptive Navigation ⚠️ **CORE STORY 1.17 DELIVERABLE**
- Task 7: Notification System
- Task 8: User Menu Integration
- Task 9: Error Handling (ErrorBoundary, toast notifications)
- Task 10: Full Routing Configuration
- Tasks 11-16: Responsive Design, Accessibility, Performance, PWA, Infrastructure

**Next Steps:**
Begin Task 6 (Role-Adaptive Navigation), which is the primary deliverable distinguishing Story 1.17 from the basic authentication foundation. This task will implement BaseLayout, AppHeader, NavigationMenu, and role-based navigation rendering.

### Debug Log References
*To be populated by Dev Agent during implementation*

### Completion Notes
*To be populated by Dev Agent during implementation*

### Files Changed

**Created:**
- `web-frontend/.env.development` - Development environment configuration
- `web-frontend/.env.staging` - Staging environment configuration
- `web-frontend/.env.production` - Production environment configuration
- `web-frontend/src/theme/theme.ts` - Material-UI Swiss design theme configuration
- `web-frontend/src/theme/index.ts` - Theme exports
- `web-frontend/tailwind.config.js` - Tailwind CSS configuration
- `web-frontend/postcss.config.js` - PostCSS configuration
- `web-frontend/src/index.css` - Global styles with Tailwind directives
- `web-frontend/src/utils/date/dateFormat.ts` - Date formatting utilities with i18n support
- `web-frontend/src/utils/date/dateFormat.test.ts` - Date formatting utility tests (16 tests)
- `web-frontend/src/utils/date/index.ts` - Date utility exports
- `web-frontend/src/stores/authStore.ts` - Zustand auth store with persist middleware
- `web-frontend/src/stores/authStore.test.ts` - Auth store tests (11 tests)
- `web-frontend/src/stores/uiStore.ts` - Zustand UI store with localStorage integration
- `web-frontend/src/stores/uiStore.test.ts` - UI store tests (13 tests)
- `web-frontend/src/hooks/useUserProfile/useUserProfile.ts` - React Query user profile hook
- `web-frontend/src/hooks/useUserProfile/useUserProfile.test.ts` - User profile hook tests (7 tests)
- `web-frontend/src/hooks/useUserProfile/index.ts` - User profile hook exports
- `web-frontend/src/hooks/useNotifications/useNotifications.ts` - React Query notifications hook
- `web-frontend/src/hooks/useNotifications/useNotifications.test.ts` - Notifications hook tests (9 tests)
- `web-frontend/src/hooks/useNotifications/index.ts` - Notifications hook exports

**Modified:**
- `web-frontend/package.json` - Added tailwindcss, postcss, autoprefixer, date-fns dependencies
- `web-frontend/src/App.tsx` - Updated to use Swiss design theme instead of inline theme
- `web-frontend/src/main.tsx` - Added index.css import for Tailwind CSS

**Deleted:**
- None

### Deployment Notes
*To be populated by Dev Agent during implementation*

**Special deployment considerations:**
- Migration order requirements: Not applicable
- Feature flag configurations: Not applicable
- Rollback procedures: Revert CloudFront distribution to previous S3 deployment
- Monitoring setup: CloudWatch alarms for 4xx/5xx error rates

## QA Results

*To be populated by QA Agent during QA review of the completed story implementation*
