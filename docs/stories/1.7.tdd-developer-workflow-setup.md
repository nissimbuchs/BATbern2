# Story 1.7: Basic Developer Workflow Setup (SIMPLIFIED)

## Status
Draft (REVISED 2025-10-02 - Simplified from comprehensive TDD story)

## Story
**As a** developer,
**I want** essential code quality checks integrated into my workflow,
**so that** I can maintain consistent code standards and catch issues early.

## ⚠️ REVISION NOTE
This story has been **SIMPLIFIED** from the original comprehensive TDD workflow setup. Advanced features (test-first validation, IDE live runners, video tutorials, mutation testing integration) have been moved to **Story B1 in the Infrastructure Enhancements backlog epic**.

**Rationale**: Basic quality gates (linting, formatting, test execution) provide 80% of value in 20% of time. Advanced TDD enforcement is valuable but not blocking for functional development.

**Effort Reduction**: 3 weeks → **1 week**

## Domain Context

### Primary Domain
Shared Infrastructure & Core Services - Development excellence and quality assurance foundation

### Involved Services
- All services benefit from TDD infrastructure
- Git hooks (pre-commit, pre-push)
- CI/CD pipeline (GitHub Actions)
- IDE configurations (IntelliJ IDEA, VS Code)

### Cross-Domain Dependencies
- **Enables**: All future story development with consistent TDD practices
- **Depends on**: Story 1.4 (CI/CD Pipeline Implementation) for automated test execution
- **Integration**: Provides quality gates for all microservices and frontend code
- **Impact**: Affects all developers across all domain services

## Requirements Context

### Related Functional Requirements
- **NFR-Quality**: Maintain 90% test coverage for business logic, 80% for APIs
- **NFR-Development**: Ensure consistent development practices across team
- **NFR-Performance**: Fast feedback loop with <30s test execution for unit tests
- **NFR-Reliability**: Prevent bugs through test-first development approach

### Workflow Steps (if applicable)
N/A - Infrastructure story supporting all development workflows

### Acceptance Criteria Source
Epic 1, Story 1.7, Lines 435-481

## Architecture Context

### Architecture Patterns
[Source: architecture/coding-standards.md#test-driven-development-standards]
- **TDD Workflow**: Red-Green-Refactor cycle mandatory for all development
- **Test Organization**: Separate unit, integration, and E2E test directories
- **Test Naming**: Descriptive naming following should_expectedBehavior_when_condition pattern
- **Coverage Requirements**: 90% for business logic, 80% for APIs, 85% overall

[Source: architecture/coding-standards.md#git-workflow]
- **Git Hooks**: Pre-commit for fast tests, pre-push for full suite
- **Commit Format**: Conventional commits with test/feat/refactor sequence
- **Branch Strategy**: Feature branches from develop with TDD workflow

[Source: architecture/07-development-standards.md#test-driven-development-process]
- **Process**: TDD is mandatory for all new features and bug fixes
- **Enforcement**: CI/CD pipeline validates test-first approach
- **Documentation**: Comprehensive TDD workflow guide required

### Infrastructure Components
[Source: architecture/tech-stack.md]

**Frontend Testing Tools:**
- **Vitest 1.0+**: Fast unit testing with TypeScript support and HMR
- **React Testing Library 13.4+**: Component testing following best practices
- **Playwright 1.40+**: End-to-end testing across browsers
- **ESLint**: Code quality enforcement with testing rules
- **Prettier**: Code formatting standardization

**Backend Testing Tools:**
- **JUnit 5.10+**: Modern testing framework with parameterized tests
- **Testcontainers 1.19+**: Integration testing with real databases
- **MockMvc**: Spring MVC testing framework for API tests
- **JaCoCo**: Code coverage analysis and reporting
- **Checkstyle**: Code quality enforcement

**Git Hooks:**
- **Husky**: Git hooks management for frontend
- **Gradle Git Hooks**: Pre-commit hooks for backend Java code
- **lint-staged**: Run linters on staged files only
- **commitlint**: Enforce conventional commit format

**CI/CD Integration:**
- **GitHub Actions**: Automated test execution and coverage reporting
- **SonarQube**: Code quality gates and test coverage visualization
- **Coverage Reports**: Automated PR comments with coverage deltas

## Wireframe Context

### Wireframe References
N/A - Infrastructure story with no direct UI components

### UI Components
IDE configurations provide visual test feedback:
- IntelliJ IDEA: Inline coverage display, continuous test runner
- VS Code: Test explorer, coverage gutters, test result decorations

## Acceptance Criteria (SIMPLIFIED - Essential Only)

**Git Hooks - Basic Quality Gates:**
1. **Pre-commit Hook**: Run ESLint/Prettier (frontend) and Checkstyle (backend) on changed files
2. **Pre-push Hook**: Execute full test suite before pushing to remote
3. **Commit Message**: Basic conventional commit format validation (feat/fix/refactor/test)
4. **Hook Installation**: Automatic hook setup via npm/gradle scripts

**Basic Documentation:**
5. **Simple Workflow Guide**: One-page guide for commit workflow and git hooks
6. **Hook Troubleshooting**: Common hook issues and fixes (skip hooks, permission errors)

## REMOVED FROM SCOPE (Moved to Backlog Story B1)

The following acceptance criteria have been **deferred to Infrastructure Enhancements epic** (Story B1):
- ❌ **AC5 (original)**: Test file templates for JUnit and Vitest
- ❌ **AC6 (original)**: Live test runner with continuous execution on file save
- ❌ **AC7 (original)**: Inline coverage indicators in code editor
- ❌ **AC8 (original)**: TDD-specific code snippets for common test patterns
- ❌ **AC9 (original)**: Advanced test-first timestamp validation
- ❌ **AC10 (original)**: Coverage regression detection and enforcement
- ❌ **AC12 (original)**: Test execution performance tracking dashboards
- ❌ **AC14-16 (original)**: Example implementations, extensive training materials, video tutorials

**Why Removed**: These features provide value but require significant setup time (IDE configurations, training content creation, complex CI/CD validation). The essential git hooks provide the core quality gates needed for development to proceed.

## Test Specifications (TDD)

### Test Scenarios by Acceptance Criteria

**AC1-4 Tests: Git Hooks Configuration**
- Test 1.1: should_runUnitTests_when_precommitHookTriggered
- Test 1.2: should_failCommit_when_testsFailInPrecommitHook
- Test 1.3: should_runFullTestSuite_when_prepushHookTriggered
- Test 1.4: should_rejectCommit_when_commitMessageInvalid
- Test 1.5: should_installHooksAutomatically_when_npmInstallRuns
- Test 1.6: should_installHooksAutomatically_when_gradleBuildRuns

**AC5-8 Tests: IDE Configuration**
- Test 2.1: should_provideTestTemplates_when_creatingNewTestFile
- Test 2.2: should_runTestsOnSave_when_liveTestRunnerEnabled
- Test 2.3: should_displayCoverageInline_when_testsExecuted
- Test 2.4: should_insertSnippet_when_tddSnippetTriggered
- Test 2.5: should_highlightUncoveredCode_when_coverageDataAvailable

**AC9-12 Tests: CI/CD Enforcement**
- Test 3.1: should_detectTestAfterImpl_when_testTimestampLaterThanCode
- Test 3.2: should_failBuild_when_coverageDecreasesFromBaseline
- Test 3.3: should_generateTestReport_when_ciPipelineRuns
- Test 3.4: should_trackExecutionTime_when_testSuiteCompletes
- Test 3.5: should_commentOnPR_when_coverageChangesDetected

**AC13-16 Tests: Documentation & Training**
- Test 4.1: should_includeWorkflowSteps_when_tddGuideLoaded
- Test 4.2: should_provideExamples_when_developersAccessGuide
- Test 4.3: should_listCommonIssues_when_troubleshootingGuideOpened
- Test 4.4: should_linkToVideoTutorials_when_trainingMaterialsAccessed

### Test File Locations

**Frontend Testing Infrastructure:**
- `web-frontend/.husky/pre-commit` - Pre-commit hook script
- `web-frontend/.husky/pre-push` - Pre-push hook script
- `web-frontend/.husky/commit-msg` - Commit message validation
- `web-frontend/scripts/test-changed-files.sh` - Test execution for changed files
- `web-frontend/.vscode/settings.json` - VS Code configuration
- `web-frontend/.vscode/extensions.json` - Recommended extensions

**Backend Testing Infrastructure:**
- `services/*/gradle/hooks/pre-commit.sh` - Gradle pre-commit hook
- `services/*/gradle/hooks/pre-push.sh` - Gradle pre-push hook
- `services/*/config/checkstyle/checkstyle.xml` - Checkstyle configuration
- `services/*/config/idea/codeStyles.xml` - IntelliJ code style
- `services/*/config/idea/runConfigurations/` - Test run configurations

**CI/CD Testing Configuration:**
- `.github/workflows/test-validation.yml` - Test-first validation workflow
- `.github/workflows/coverage-report.yml` - Coverage reporting workflow
- `.github/scripts/detect-test-timing.sh` - Test timestamp detection script
- `.github/scripts/coverage-delta.sh` - Coverage comparison script

**Documentation:**
- `docs/guides/tdd-workflow.md` - Comprehensive TDD workflow guide
- `docs/guides/tdd-examples/` - Example implementations directory
- `docs/guides/troubleshooting-tdd.md` - TDD troubleshooting guide
- `docs/videos/tdd-demo.mp4` - Video tutorial recording

### Test Data & Mocks

**Test Scenarios:**
- Valid commit with tests before implementation
- Invalid commit with tests after implementation
- Coverage increase/decrease scenarios
- Test execution time benchmarks
- Git hook execution simulations

**Mock Services:**
- Mock Git operations for hook testing
- Mock test runners for timing validation
- Mock coverage reporters for delta analysis
- Simulated IDE integrations

**Test Configurations:**
- Sample test files for template validation
- Coverage baseline files
- Test execution reports
- Git history with timestamps

## Tasks / Subtasks (TDD Workflow)

- [ ] Task 1: Write E2E Tests for Git Hook Integration (RED Phase)
  - [ ] Write failing E2E test for pre-commit hook preventing bad commits
  - [ ] Write failing E2E test for pre-push hook running full suite
  - [ ] Write failing test for commit message validation
  - [ ] Verify tests fail with meaningful error messages

- [ ] Task 2: Frontend Git Hooks TDD Implementation (AC: 1, 2, 3, 4)
  - [ ] Write failing tests for Husky hook installation
  - [ ] Write failing tests for pre-commit test execution
  - [ ] Write failing tests for commit message format validation
  - [ ] Write failing tests for staged file test detection
  - [ ] Implement Husky configuration with pre-commit hook (GREEN)
  - [ ] Implement pre-push hook with full test suite execution (GREEN)
  - [ ] Implement commitlint for message validation (GREEN)
  - [ ] Implement lint-staged for efficient testing (GREEN)
  - [ ] Refactor hook scripts for maintainability (REFACTOR)

- [ ] Task 3: Backend Git Hooks TDD Implementation (AC: 1, 2, 3, 4)
  - [ ] Write failing tests for Gradle hook installation
  - [ ] Write failing tests for pre-commit Checkstyle execution
  - [ ] Write failing tests for pre-commit unit test execution
  - [ ] Write failing tests for commit message validation
  - [ ] Implement Gradle pre-commit hook plugin (GREEN)
  - [ ] Configure Checkstyle integration in pre-commit (GREEN)
  - [ ] Configure JUnit execution in pre-commit hook (GREEN)
  - [ ] Implement commit message validation script (GREEN)
  - [ ] Refactor Gradle hook configuration (REFACTOR)

- [ ] Task 4: IDE Configuration TDD Implementation (AC: 5, 6, 7, 8)
  - [ ] Write failing tests for test template generation
  - [ ] Write failing tests for live test runner configuration
  - [ ] Write failing tests for coverage display integration
  - [ ] Write failing tests for snippet insertion
  - [ ] Create VS Code test file templates (GREEN)
  - [ ] Create IntelliJ IDEA test file templates (GREEN)
  - [ ] Configure continuous test execution in both IDEs (GREEN)
  - [ ] Configure coverage display plugins and settings (GREEN)
  - [ ] Create TDD code snippets for both IDEs (GREEN)
  - [ ] Refactor IDE configurations for consistency (REFACTOR)

- [ ] Task 5: CI/CD Test Enforcement TDD Implementation (AC: 9, 10, 11, 12)
  - [ ] Write failing tests for test-first timestamp validation
  - [ ] Write failing tests for coverage regression detection
  - [ ] Write failing tests for test report generation
  - [ ] Write failing tests for performance tracking
  - [ ] Implement GitHub Action for test timestamp validation (GREEN)
  - [ ] Implement coverage baseline comparison workflow (GREEN)
  - [ ] Implement test report generation and archiving (GREEN)
  - [ ] Implement test execution time tracking (GREEN)
  - [ ] Refactor CI/CD workflows for efficiency (REFACTOR)

- [ ] Task 6: Documentation Creation (AC: 13, 14, 15, 16)
  - [ ] Write comprehensive TDD workflow guide
  - [ ] Create example story with complete TDD implementation
  - [ ] Document common TDD issues and solutions
  - [ ] Record video demonstration of TDD workflow
  - [ ] Create quick reference cards for TDD process
  - [ ] Document IDE setup instructions for new developers

- [ ] Task 7: Integration Testing & Validation
  - [ ] Test complete workflow from commit to CI/CD
  - [ ] Validate hook installation on fresh clone
  - [ ] Verify IDE configurations work on team machines
  - [ ] Test coverage regression detection with real scenarios
  - [ ] Validate test-first enforcement in CI pipeline
  - [ ] Run training session with team to gather feedback

## Dev Notes - Implementation Guide

### Service Setup

**Project Root Structure:**
```
BATbern-Platform/
├── .github/
│   ├── workflows/
│   │   ├── test-validation.yml         # Test-first validation
│   │   ├── coverage-report.yml         # Coverage reporting
│   │   └── tdd-enforcement.yml         # TDD workflow enforcement
│   └── scripts/
│       ├── detect-test-timing.sh       # Timestamp analysis
│       ├── coverage-delta.sh           # Coverage comparison
│       └── generate-test-report.sh     # Report generation
├── web-frontend/
│   ├── .husky/
│   │   ├── pre-commit                  # Frontend pre-commit hook
│   │   ├── pre-push                    # Frontend pre-push hook
│   │   └── commit-msg                  # Commit validation
│   ├── .vscode/
│   │   ├── settings.json               # VS Code settings
│   │   ├── extensions.json             # Recommended extensions
│   │   └── snippets/
│   │       └── tdd.code-snippets       # TDD snippets
│   ├── scripts/
│   │   ├── test-changed-files.sh       # Smart test execution
│   │   └── setup-dev-env.sh            # Developer setup
│   └── package.json                    # NPM scripts and hooks
├── services/
│   └── {service-name}/
│       ├── gradle/
│       │   └── hooks/
│       │       ├── pre-commit.sh       # Gradle pre-commit
│       │       └── pre-push.sh         # Gradle pre-push
│       ├── config/
│       │   ├── checkstyle/
│       │   │   └── checkstyle.xml      # Checkstyle rules
│       │   └── idea/
│       │       ├── codeStyles.xml      # IntelliJ styles
│       │       └── runConfigurations/  # Test runners
│       └── build.gradle                # Gradle configuration
└── docs/
    └── guides/
        ├── tdd-workflow.md             # TDD guide
        ├── tdd-examples/               # Example implementations
        ├── troubleshooting-tdd.md      # Troubleshooting
        └── ide-setup.md                # IDE configuration guide
```

### Technical Design Notes

**Frontend Git Hooks (Husky + lint-staged):**

`web-frontend/package.json`:
```json
{
  "scripts": {
    "prepare": "husky install",
    "test": "vitest run",
    "test:changed": "vitest related --run",
    "test:watch": "vitest",
    "lint": "eslint src --ext ts,tsx",
    "format:check": "prettier --check src"
  },
  "devDependencies": {
    "husky": "^8.0.3",
    "lint-staged": "^15.2.0",
    "@commitlint/cli": "^18.4.3",
    "@commitlint/config-conventional": "^18.4.3"
  },
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write",
      "vitest related --run --passWithNoTests"
    ]
  }
}
```

`web-frontend/.husky/pre-commit`:
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Running pre-commit checks..."

# Run lint-staged for changed files
npx lint-staged

# Check if tests passed
if [ $? -ne 0 ]; then
  echo "❌ Pre-commit tests failed. Please fix errors before committing."
  exit 1
fi

echo "✅ Pre-commit checks passed!"
```

`web-frontend/.husky/pre-push`:
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🧪 Running full test suite before push..."

# Run full test suite
npm run test

if [ $? -ne 0 ]; then
  echo "❌ Test suite failed. Push aborted."
  exit 1
fi

# Check coverage hasn't decreased
npm run test:coverage
node scripts/check-coverage-regression.js

if [ $? -ne 0 ]; then
  echo "❌ Coverage regression detected. Push aborted."
  exit 1
fi

echo "✅ All tests passed! Proceeding with push."
```

`web-frontend/.husky/commit-msg`:
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Validate commit message format
npx --no -- commitlint --edit $1
```

**Commitlint Configuration:**

`web-frontend/.commitlintrc.json`:
```json
{
  "extends": ["@commitlint/config-conventional"],
  "rules": {
    "type-enum": [
      2,
      "always",
      [
        "test",    // Test changes (TDD RED phase)
        "feat",    // New feature (TDD GREEN phase)
        "fix",     // Bug fix (TDD GREEN phase)
        "refactor",// Code refactoring (TDD REFACTOR phase)
        "docs",    // Documentation
        "style",   // Code style changes
        "chore"    // Maintenance tasks
      ]
    ],
    "type-case": [2, "always", "lower-case"],
    "subject-case": [2, "always", "sentence-case"],
    "subject-empty": [2, "never"]
  }
}
```

**Backend Git Hooks (Gradle):**

`services/shared-kernel/build.gradle`:
```gradle
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.1'
    id 'io.spring.dependency-management' version '1.1.4'
    id 'checkstyle'
    id 'jacoco'
}

// Install git hooks automatically
tasks.register('installGitHooks', Copy) {
    from 'gradle/hooks'
    into '.git/hooks'
    fileMode 0755
}

tasks.named('build') {
    dependsOn 'installGitHooks'
}

// Checkstyle configuration
checkstyle {
    toolVersion = '10.12.5'
    configFile = file("${rootDir}/config/checkstyle/checkstyle.xml")
}

// JaCoCo coverage configuration
jacoco {
    toolVersion = "0.8.11"
}

jacocoTestReport {
    reports {
        xml.required = true
        html.required = true
    }
    afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.collect {
            fileTree(dir: it, exclude: [
                '**/config/**',
                '**/dto/**',
                '**/entity/**'
            ])
        }))
    }
}

// Coverage enforcement
jacocoTestCoverageVerification {
    violationRules {
        rule {
            limit {
                minimum = 0.85 // 85% minimum coverage
            }
        }
        rule {
            element = 'CLASS'
            limit {
                counter = 'LINE'
                value = 'COVEREDRATIO'
                minimum = 0.80
            }
            excludes = [
                '*.config.*',
                '*.dto.*',
                '*.entity.*'
            ]
        }
    }
}

test.finalizedBy jacocoTestReport
check.dependsOn jacocoTestCoverageVerification
```

`services/*/gradle/hooks/pre-commit.sh`:
```bash
#!/bin/bash
echo "🔍 Running pre-commit checks for Java service..."

# Get changed Java files
CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.java$')

if [ -z "$CHANGED_FILES" ]; then
    echo "✅ No Java files changed"
    exit 0
fi

# Run Checkstyle on changed files
echo "Running Checkstyle..."
./gradlew checkstyleMain checkstyleTest

if [ $? -ne 0 ]; then
    echo "❌ Checkstyle violations found. Please fix before committing."
    exit 1
fi

# Run unit tests for changed files
echo "Running unit tests for changed files..."
./gradlew test --tests '*Test'

if [ $? -ne 0 ]; then
    echo "❌ Unit tests failed. Please fix before committing."
    exit 1
fi

echo "✅ Pre-commit checks passed!"
exit 0
```

`services/*/gradle/hooks/pre-push.sh`:
```bash
#!/bin/bash
echo "🧪 Running full test suite for Java service..."

# Run all tests including integration tests
./gradlew clean test integrationTest

if [ $? -ne 0 ]; then
    echo "❌ Test suite failed. Push aborted."
    exit 1
fi

# Verify coverage requirements
./gradlew jacocoTestCoverageVerification

if [ $? -ne 0 ]; then
    echo "❌ Coverage requirements not met. Push aborted."
    exit 1
fi

echo "✅ All tests passed and coverage requirements met!"
exit 0
```

**VS Code Configuration:**

`.vscode/settings.json`:
```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "vitest.enable": true,
  "vitest.commandLine": "npm run test:watch",
  "coverage-gutters.coverageFileNames": [
    "coverage/lcov.info"
  ],
  "coverage-gutters.showGutterCoverage": true,
  "coverage-gutters.showLineCoverage": true,
  "typescript.preferences.importModuleSpecifier": "relative",
  "testing.automaticallyOpenPeekView": "failureInVisibleDocument"
}
```

`.vscode/extensions.json`:
```json
{
  "recommendations": [
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "ZixuanChen.vitest-explorer",
    "ryanluker.vscode-coverage-gutters",
    "usernamehw.errorlens",
    "streetsidesoftware.code-spell-checker"
  ]
}
```

`.vscode/snippets/tdd.code-snippets`:
```json
{
  "React Component Test": {
    "prefix": "tdd-component",
    "body": [
      "import { render, screen } from '@testing-library/react';",
      "import { ${1:ComponentName} } from './${1:ComponentName}';",
      "",
      "describe('${1:ComponentName}', () => {",
      "  test('should_${2:expectedBehavior}_when_${3:condition}', () => {",
      "    // Given",
      "    const props = {$4};",
      "",
      "    // When",
      "    render(<${1:ComponentName} {...props} />);",
      "",
      "    // Then",
      "    expect(screen.getByText('${5:expected text}')).toBeInTheDocument();",
      "  });",
      "});"
    ],
    "description": "TDD test template for React component"
  },
  "Java Unit Test": {
    "prefix": "tdd-unit",
    "body": [
      "@Test",
      "void should_${1:expectedBehavior}_when_${2:condition}() {",
      "    // Given",
      "    ${3:// Setup test data}",
      "",
      "    // When",
      "    ${4:// Execute the operation}",
      "",
      "    // Then",
      "    ${5:// Assert expectations}",
      "}"
    ],
    "description": "TDD test template for Java unit test"
  }
}
```

**IntelliJ IDEA Configuration:**

`services/*/config/idea/codeStyles.xml`:
```xml
<component name="ProjectCodeStyleConfiguration">
  <code_scheme name="BATbern" version="173">
    <option name="RIGHT_MARGIN" value="120" />
    <JavaCodeStyleSettings>
      <option name="CLASS_COUNT_TO_USE_IMPORT_ON_DEMAND" value="999" />
      <option name="NAMES_COUNT_TO_USE_IMPORT_ON_DEMAND" value="999" />
      <option name="PACKAGES_TO_USE_IMPORT_ON_DEMAND">
        <value />
      </option>
    </JavaCodeStyleSettings>
  </code_scheme>
</component>
```

`services/*/config/idea/runConfigurations/All Tests with Coverage.xml`:
```xml
<component name="ProjectRunConfigurationManager">
  <configuration default="false" name="All Tests with Coverage" type="JUnit" factoryName="JUnit">
    <module name="event-management-service.test" />
    <option name="PACKAGE_NAME" value="" />
    <option name="MAIN_CLASS_NAME" value="" />
    <option name="METHOD_NAME" value="" />
    <option name="TEST_OBJECT" value="package" />
    <method v="2">
      <option name="Make" enabled="true" />
    </method>
  </configuration>
</component>
```

**CI/CD Test Validation:**

`.github/workflows/tdd-enforcement.yml`:
```yaml
name: TDD Enforcement

on:
  pull_request:
    branches: [develop, main]

jobs:
  validate-test-first:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Detect test timing
        run: |
          chmod +x .github/scripts/detect-test-timing.sh
          ./.github/scripts/detect-test-timing.sh

      - name: Check coverage regression
        run: |
          chmod +x .github/scripts/coverage-delta.sh
          ./.github/scripts/coverage-delta.sh

      - name: Comment on PR
        uses: actions/github-script@v7
        if: always()
        with:
          script: |
            const fs = require('fs');
            const report = fs.readFileSync('tdd-report.md', 'utf8');
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: report
            });
```

`.github/scripts/detect-test-timing.sh`:
```bash
#!/bin/bash

echo "# TDD Validation Report" > tdd-report.md
echo "" >> tdd-report.md

# Get changed files in PR
CHANGED_FILES=$(git diff --name-only origin/develop...HEAD)

for file in $CHANGED_FILES; do
  if [[ $file == *".test.ts"* ]] || [[ $file == *".test.tsx"* ]] || [[ $file == *"Test.java"* ]]; then
    TEST_FILE=$file
    # Determine implementation file
    IMPL_FILE=$(echo $TEST_FILE | sed 's/.test.ts/.ts/' | sed 's/.test.tsx/.tsx/' | sed 's/Test.java/.java/' | sed 's/src\/test/src\/main/')

    if [ -f "$IMPL_FILE" ]; then
      TEST_TIME=$(git log -1 --format=%at -- "$TEST_FILE")
      IMPL_TIME=$(git log -1 --format=%at -- "$IMPL_FILE")

      if [ $TEST_TIME -gt $IMPL_TIME ]; then
        echo "⚠️ **Warning**: Test file \`$TEST_FILE\` was committed after implementation \`$IMPL_FILE\`" >> tdd-report.md
        echo "This violates TDD practices. Tests should be written first (RED phase)." >> tdd-report.md
        echo "" >> tdd-report.md
      else
        echo "✅ Test file \`$TEST_FILE\` follows TDD (committed before implementation)" >> tdd-report.md
        echo "" >> tdd-report.md
      fi
    fi
  fi
done
```

### API Contracts

N/A - Infrastructure story with no direct API contracts.

### Testing Requirements

**Hook Installation Tests:**
- Verify hooks are installed on `npm install` / `gradle build`
- Test hook execution with various scenarios
- Validate hook failure prevents commit/push

**IDE Configuration Tests:**
- Verify templates generate correct test structure
- Test coverage display updates on test execution
- Validate snippets insert correct code patterns

**CI/CD Integration Tests:**
- Test timestamp detection accuracy
- Verify coverage regression detection
- Validate PR comment generation

**End-to-End Workflow Tests:**
- Complete TDD workflow from feature start to merge
- Multi-developer collaboration scenarios
- Coverage baseline management

## Definition of Done Checklist (SIMPLIFIED)

### Development Complete
- [ ] Pre-commit hooks run linting and formatting checks in <10 seconds
- [ ] Pre-push hooks execute test suite and prevent push on failure
- [ ] Conventional commit format enforced with helpful error messages
- [ ] Hooks automatically installed on `npm install` and `gradle build`
- [ ] Hook scripts have proper error handling
- [ ] All hooks tested on macOS, Linux, and Windows

### Documentation Complete
- [ ] Simple one-page workflow guide added to docs/
- [ ] Hook troubleshooting section with common issues (skip hooks, permissions)
- [ ] Installation instructions verified on clean checkout

### Operational Complete
- [ ] All developers successfully use hooks (tested on team machines)
- [ ] Hook bypass instructions documented (for emergency situations)
- [ ] Team onboarding includes hook setup verification

### Review Ready
- [ ] PR created with detailed description
- [ ] Infrastructure review completed
- [ ] Developer experience validated by 2+ team members
- [ ] Documentation reviewed and approved

**Note**: Advanced IDE configurations, coverage display, test-first validation, and training materials have been deferred to Story B1 (Infrastructure Enhancements backlog).

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-02 | 1.0 | Initial story creation | Scrum Master Bob |
| 2025-10-02 | 2.0 | SIMPLIFIED - Reduced from comprehensive TDD to basic quality gates. Effort 3w→1w. Advanced features moved to Story B1 (Infrastructure Enhancements backlog). | Winston (Architect) |

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent during implementation_

### Implementation Approach
_To be documented by dev agent with actual approach taken_

### Debug Log References
_To be populated with debug log references during development_

### Completion Notes
_To be filled with issues encountered and resolutions_

### Files Changed
_To be populated with list of created, modified, and deleted files_

### Deployment Notes
_Special deployment considerations for TDD infrastructure setup_

## QA Results
_To be populated by QA Agent after implementation review_
