# Story 1.8: Advanced Quality Infrastructure & TDD Automation (üì¶ MOVED TO BACKLOG)

## Status
üì¶ **BACKLOG** - Deferred to "Infrastructure Enhancements" Epic (Story B1)

## Story
**As a** tech lead,
**I want** automated quality gates and TDD enforcement in our development workflow,
**so that** we maintain high code quality and prevent technical debt accumulation.

## ‚ö†Ô∏è DECISION: MOVED TO BACKLOG (2025-10-02)

This story has been **deferred to the Infrastructure Enhancements backlog epic** as **Story B1**.

**Why Deferred:**
- Story 1.4 (CI/CD Pipeline) already provides basic quality gates and test execution
- Story 1.7 (Basic Developer Workflow) provides git hooks for linting and basic checks
- GitHub's built-in security scanning (Dependabot, CodeQL) covers vulnerability detection
- SonarQube, mutation testing, and advanced quality dashboards are valuable but not blocking MVP delivery

**Current Alternative:**
- Use GitHub code scanning for security vulnerabilities
- Basic test coverage reporting from CI/CD pipeline (Story 1.4)
- Simple git hooks for linting and test execution (Story 1.7)
- Manual code review for quality

**When to Implement:**
- Codebase exceeds 50,000 lines of code
- Team size grows beyond 5 developers
- Technical debt metrics show concerning trends
- Regulatory compliance requires advanced quality tracking
- After Epic 2-3 when you have substantial codebase to analyze

**Time Saved:** 3-4 weeks ‚Üí redirected to functional features

**See**: [epic-backlog-infrastructure-enhancements.md](../prd/epic-backlog-infrastructure-enhancements.md) - Story B1

## Domain Context

### Primary Domain
Shared Infrastructure & Core Services - Code quality assurance and automated enforcement

### Involved Services
- All microservices (quality gates apply universally)
- SonarQube (code quality analysis)
- GitHub Actions (CI/CD quality enforcement)
- JaCoCo/NYC (coverage reporting)

### Cross-Domain Dependencies
- **Depends on**: Story 1.7 (TDD Developer Workflow Setup) for git hooks foundation
- **Depends on**: Story 1.4 (CI/CD Pipeline Implementation) for automation infrastructure
- **Enables**: Automated quality enforcement for all future development
- **Integration**: Provides quality metrics and gates for all services

## Requirements Context

### Related Functional Requirements
- **NFR-Quality**: Maintain code quality standards across entire platform
- **NFR-Maintainability**: Prevent technical debt through automated enforcement
- **NFR-Security**: Automated security vulnerability scanning
- **NFR-Performance**: Code complexity limits to ensure performance

### Workflow Steps (if applicable)
N/A - Infrastructure story supporting all development workflows

### Acceptance Criteria Source
Epic 1, Story 1.8, Lines 483-529

## Architecture Context

### Architecture Patterns
[Source: architecture/coding-standards.md#code-quality-standards]
- **Pre-commit Hooks**: Format check, lint, unit tests before commit
- **Quality Gates**: Coverage, complexity, duplication, security thresholds
- **Code Review**: Automated PR checks and manual review requirements
- **Branch Protection**: Enforce quality standards before merge

[Source: architecture/coding-standards.md#test-driven-development-standards]
- **TDD Enforcement**: Tests must be written before implementation
- **Coverage Requirements**: 90% business logic, 80% APIs, 85% overall
- **Test Quality**: Mutation testing to validate test effectiveness
- **Regression Prevention**: Automated regression suite execution

[Source: architecture/08-operations-security.md#performance-benchmarks]
- **Performance SLAs**: Production 99.9% availability, <200ms P95 response
- **Code Complexity**: Cyclomatic complexity limits to maintain quality
- **Bundle Size**: Frontend <250KB initial bundle, <1MB total
- **Security**: No high/critical vulnerabilities in production

### Infrastructure Components
[Source: architecture/tech-stack.md]

**Quality Analysis Tools:**
- **SonarQube**: Code quality analysis, security scanning, technical debt tracking
- **JaCoCo 0.8.11**: Java code coverage analysis and reporting
- **NYC (Istanbul)**: JavaScript/TypeScript coverage reporting
- **ESLint**: JavaScript/TypeScript linting with custom rules
- **Checkstyle 10.12+**: Java code style enforcement
- **Prettier**: Code formatting standardization

**Testing Tools:**
- **PITest**: Mutation testing for Java to validate test quality
- **Stryker**: Mutation testing for TypeScript/JavaScript
- **JUnit 5.10+**: Java unit and integration testing
- **Vitest 1.0+**: Fast TypeScript testing with coverage

**CI/CD Integration:**
- **GitHub Actions**: Automated quality gate enforcement
- **Branch Protection Rules**: Require passing checks before merge
- **CODEOWNERS**: Automatic reviewer assignment
- **PR Templates**: Standardized pull request format

**Monitoring & Reporting:**
- **SonarCloud/SonarQube**: Quality dashboards and trends
- **CodeCov/Codecov**: Coverage trend visualization
- **GitHub Status Checks**: Pass/fail indicators on PRs
- **Quality Badges**: README badges showing quality metrics

## Wireframe Context

### Wireframe References
N/A - Infrastructure story with no direct UI components

### UI Components
Quality dashboards are external tools (SonarQube, GitHub PR interface), not in application UI

## Acceptance Criteria

1. **Pre-commit Hooks**: Format check, lint, unit tests
2. **Pre-push Hooks**: Full test suite execution
3. **Commit Message**: Conventional commit enforcement
4. **Branch Protection**: Require PR reviews and passing checks
5. **Code Coverage**: Minimum 90% for business logic
6. **Complexity Metrics**: Cyclomatic complexity limits
7. **Duplication Check**: Maximum 3% code duplication
8. **Security Scan**: No high/critical vulnerabilities
9. **Test-First Enforcement**: Require tests before implementation
10. **Coverage Delta**: New code must have >90% coverage
11. **Test Quality**: Mutation testing for test effectiveness
12. **Regression Prevention**: Automated regression suite
13. **Fast Feedback**: Test results in <30 seconds
14. **IDE Integration**: Real-time quality feedback
15. **Documentation**: TDD workflow documentation
16. **Training Materials**: TDD best practices guide

## Test Specifications (TDD)

### Test Scenarios by Acceptance Criteria

**AC1-4 Tests: Git Hook and Branch Protection Configuration**
- Test 1.1: should_runFormatCheck_when_precommitHookTriggered
- Test 1.2: should_runLinter_when_precommitHookTriggered
- Test 1.3: should_runUnitTests_when_precommitHookTriggered
- Test 1.4: should_blockMerge_when_branchProtectionViolated
- Test 1.5: should_requireReviews_when_prCreated
- Test 1.6: should_enforceConventionalCommits_when_commitMessageValidated

**AC5-8 Tests: Quality Gate Enforcement**
- Test 2.1: should_failBuild_when_coverageBelow90Percent
- Test 2.2: should_failBuild_when_complexityExceedsLimit
- Test 2.3: should_failBuild_when_duplicationAbove3Percent
- Test 2.4: should_failBuild_when_criticalVulnerabilitiesFound
- Test 2.5: should_generateQualityReport_when_analysisCompletes
- Test 2.6: should_commentOnPR_when_qualityIssuesDetected

**AC9-12 Tests: TDD and Test Quality Enforcement**
- Test 3.1: should_detectTestFirst_when_gitHistoryAnalyzed
- Test 3.2: should_failBuild_when_newCodeCoverageBelowThreshold
- Test 3.3: should_runMutationTests_when_testQualityChecked
- Test 3.4: should_executeregressionSuite_when_ciPipelineRuns
- Test 3.5: should_reportMutationScore_when_mutationTestingCompletes

**AC13-16 Tests: Developer Experience and Documentation**
- Test 4.1: should_provideFeedbackQuickly_when_testsExecute
- Test 4.2: should_displayInlineWarnings_when_qualityIssuesDetected
- Test 4.3: should_includeWorkflowSteps_when_documentationAccessed
- Test 4.4: should_provideExamples_when_trainingMaterialsViewed

### Test File Locations

**Quality Infrastructure Tests:**
- `infrastructure/test/quality/sonarqube-config.test.ts`
- `infrastructure/test/quality/coverage-gates.test.ts`
- `infrastructure/test/quality/mutation-testing.test.ts`
- `infrastructure/test/quality/branch-protection.test.ts`

**CI/CD Workflow Tests:**
- `.github/workflows-tests/quality-gates.test.ts`
- `.github/workflows-tests/coverage-enforcement.test.ts`
- `.github/workflows-tests/security-scanning.test.ts`

**Backend Quality Tests:**
- `services/*/src/test/quality/CodeCoverageIntegrationTest.java`
- `services/*/src/test/quality/MutationTestingValidationTest.java`

**Frontend Quality Tests:**
- `web-frontend/tests/quality/coverage-threshold.test.ts`
- `web-frontend/tests/quality/bundle-size.test.ts`
- `web-frontend/tests/quality/performance-budget.test.ts`

### Test Data & Mocks

**Test Scenarios:**
- Code with varying coverage levels (50%, 85%, 95%)
- Complex code exceeding cyclomatic complexity limits
- Duplicated code blocks for duplication detection
- Sample vulnerabilities for security scanning
- Mutation testing survivors (tests that don't catch mutations)

**Mock Services:**
- Mock SonarQube API responses
- Mock coverage report generation
- Mock mutation testing results
- Simulated PR checks and status updates

**Test Configurations:**
- Sample SonarQube quality profiles
- Coverage baseline configurations
- Mutation testing configurations
- Branch protection rule templates

## Tasks / Subtasks (TDD Workflow)

- [ ] Task 1: Write E2E Tests for Quality Gates (RED Phase)
  - [ ] Write failing E2E test for coverage enforcement blocking merge
  - [ ] Write failing E2E test for complexity limit enforcement
  - [ ] Write failing E2E test for security vulnerability blocking deployment
  - [ ] Verify tests fail with meaningful error messages

- [ ] Task 2: SonarQube Integration TDD Implementation (AC: 5, 6, 7, 8)
  - [ ] Write failing tests for SonarQube server configuration
  - [ ] Write failing tests for quality gate configuration
  - [ ] Write failing tests for coverage threshold enforcement
  - [ ] Write failing tests for complexity metrics
  - [ ] Write failing tests for duplication detection
  - [ ] Write failing tests for security vulnerability scanning
  - [ ] Implement SonarQube server deployment (AWS ECS or standalone) (GREEN)
  - [ ] Configure quality profiles for Java and TypeScript (GREEN)
  - [ ] Implement coverage threshold rules (90% business logic) (GREEN)
  - [ ] Configure complexity gates (cyclomatic complexity <15) (GREEN)
  - [ ] Configure duplication threshold (<3%) (GREEN)
  - [ ] Integrate security scanning plugins (GREEN)
  - [ ] Refactor configuration for maintainability (REFACTOR)

- [ ] Task 3: Coverage Enforcement TDD Implementation (AC: 5, 10)
  - [ ] Write failing tests for JaCoCo configuration
  - [ ] Write failing tests for NYC/Istanbul configuration
  - [ ] Write failing tests for coverage delta calculation
  - [ ] Write failing tests for PR coverage comments
  - [ ] Implement JaCoCo Gradle plugin configuration (GREEN)
  - [ ] Implement NYC coverage reporting for frontend (GREEN)
  - [ ] Create GitHub Action for coverage delta analysis (GREEN)
  - [ ] Implement automated PR comments with coverage data (GREEN)
  - [ ] Refactor coverage reporting scripts (REFACTOR)

- [ ] Task 4: Mutation Testing TDD Implementation (AC: 11)
  - [ ] Write failing tests for PITest configuration
  - [ ] Write failing tests for Stryker configuration
  - [ ] Write failing tests for mutation score calculation
  - [ ] Write failing tests for mutation report generation
  - [ ] Implement PITest Gradle plugin for Java services (GREEN)
  - [ ] Implement Stryker for frontend mutation testing (GREEN)
  - [ ] Configure mutation score thresholds (>80%) (GREEN)
  - [ ] Create mutation testing reports and dashboards (GREEN)
  - [ ] Refactor mutation testing configuration (REFACTOR)

- [ ] Task 5: GitHub Branch Protection TDD Implementation (AC: 4)
  - [ ] Write failing tests for branch protection rule creation
  - [ ] Write failing tests for required status checks
  - [ ] Write failing tests for required reviewer configuration
  - [ ] Write failing tests for CODEOWNERS enforcement
  - [ ] Configure branch protection for main/develop branches (GREEN)
  - [ ] Set required status checks (tests, coverage, quality) (GREEN)
  - [ ] Configure required reviewers and CODEOWNERS (GREEN)
  - [ ] Set up dismiss stale reviews on new commits (GREEN)
  - [ ] Refactor branch protection configuration (REFACTOR)

- [ ] Task 6: CI/CD Quality Gates TDD Implementation (AC: 9, 12, 13)
  - [ ] Write failing tests for quality gate workflow
  - [ ] Write failing tests for test-first validation
  - [ ] Write failing tests for regression suite execution
  - [ ] Write failing tests for performance benchmarking
  - [ ] Create GitHub Action for quality gate enforcement (GREEN)
  - [ ] Implement test-first timestamp validation (GREEN)
  - [ ] Configure automated regression suite (GREEN)
  - [ ] Set up performance budget enforcement (GREEN)
  - [ ] Refactor CI/CD workflows for efficiency (REFACTOR)

- [ ] Task 7: IDE Integration & Developer Experience (AC: 14, 15, 16)
  - [ ] Configure SonarLint for IntelliJ IDEA
  - [ ] Configure SonarLint for VS Code
  - [ ] Set up ESLint and Prettier IDE integration
  - [ ] Create developer onboarding documentation
  - [ ] Write TDD best practices guide
  - [ ] Create video tutorials for quality tools
  - [ ] Document troubleshooting common quality issues

- [ ] Task 8: Quality Monitoring & Dashboards
  - [ ] Set up SonarQube quality dashboards
  - [ ] Configure coverage trend tracking
  - [ ] Create mutation score tracking dashboard
  - [ ] Set up quality metric alerts
  - [ ] Document quality metrics interpretation
  - [ ] Train team on using quality dashboards

## Dev Notes - Implementation Guide

### Service Setup

**Project Root Structure:**
```
BATbern-Platform/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îú‚îÄ‚îÄ workflows/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ quality-gates.yml           # Quality enforcement workflow
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ coverage-check.yml          # Coverage analysis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mutation-testing.yml        # Mutation test execution
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ security-scan.yml           # Security vulnerability scan
‚îÇ   ‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ check-coverage-delta.sh     # Coverage comparison
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analyze-complexity.sh       # Complexity analysis
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mutation-report.sh          # Mutation test reporting
‚îÇ   ‚îú‚îÄ‚îÄ CODEOWNERS                      # Code ownership rules
‚îÇ   ‚îî‚îÄ‚îÄ pull_request_template.md        # PR template with checklist
‚îú‚îÄ‚îÄ sonarqube/
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml              # SonarQube local setup
‚îÇ   ‚îú‚îÄ‚îÄ quality-profiles/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java-quality-profile.xml    # Java quality rules
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ typescript-quality-profile.xml # TS quality rules
‚îÇ   ‚îî‚îÄ‚îÄ sonar-project.properties        # SonarQube config
‚îú‚îÄ‚îÄ web-frontend/
‚îÇ   ‚îú‚îÄ‚îÄ .eslintrc.js                    # ESLint configuration
‚îÇ   ‚îú‚îÄ‚îÄ .prettierrc.js                  # Prettier configuration
‚îÇ   ‚îú‚îÄ‚îÄ stryker.conf.json               # Mutation testing config
‚îÇ   ‚îú‚îÄ‚îÄ vitest.config.ts                # Vitest with coverage
‚îÇ   ‚îî‚îÄ‚îÄ performance-budget.json         # Bundle size limits
‚îî‚îÄ‚îÄ services/{service-name}/
    ‚îú‚îÄ‚îÄ build.gradle                    # Gradle with quality plugins
    ‚îú‚îÄ‚îÄ config/
    ‚îÇ   ‚îú‚îÄ‚îÄ checkstyle/checkstyle.xml   # Checkstyle rules
    ‚îÇ   ‚îú‚îÄ‚îÄ pmd/pmd-ruleset.xml         # PMD rules
    ‚îÇ   ‚îî‚îÄ‚îÄ spotbugs/spotbugs-exclude.xml # SpotBugs config
    ‚îî‚îÄ‚îÄ sonar-project.properties        # Service SonarQube config
```

### Technical Design Notes

**SonarQube Configuration:**

`sonarqube/docker-compose.yml`:
```yaml
version: '3.8'

services:
  sonarqube:
    image: sonarqube:10.3-community
    container_name: batbern-sonarqube
    ports:
      - "9000:9000"
    environment:
      - SONAR_ES_BOOTSTRAP_CHECKS_DISABLE=true
      - SONAR_JDBC_URL=jdbc:postgresql://postgres:5432/sonarqube
      - SONAR_JDBC_USERNAME=sonar
      - SONAR_JDBC_PASSWORD=sonar
    volumes:
      - sonarqube_data:/opt/sonarqube/data
      - sonarqube_extensions:/opt/sonarqube/extensions
      - sonarqube_logs:/opt/sonarqube/logs
      - ./quality-profiles:/opt/quality-profiles
    depends_on:
      - postgres
    networks:
      - sonar-network

  postgres:
    image: postgres:15
    container_name: sonarqube-postgres
    environment:
      - POSTGRES_USER=sonar
      - POSTGRES_PASSWORD=sonar
      - POSTGRES_DB=sonarqube
    volumes:
      - postgresql_data:/var/lib/postgresql/data
    networks:
      - sonar-network

volumes:
  sonarqube_data:
  sonarqube_extensions:
  sonarqube_logs:
  postgresql_data:

networks:
  sonar-network:
    driver: bridge
```

`sonarqube/quality-profiles/java-quality-profile.xml`:
```xml
<profile>
  <name>BATbern Java Quality Profile</name>
  <language>java</language>
  <rules>
    <!-- Complexity Rules -->
    <rule>
      <repositoryKey>squid</repositoryKey>
      <key>S1541</key> <!-- Cyclomatic Complexity -->
      <priority>MAJOR</priority>
      <parameters>
        <parameter>
          <key>max</key>
          <value>15</value> <!-- Maximum complexity per method -->
        </parameter>
      </parameters>
    </rule>

    <!-- Coverage Rules -->
    <rule>
      <repositoryKey>common-java</repositoryKey>
      <key>InsufficientLineCoverage</key>
      <priority>MAJOR</priority>
      <parameters>
        <parameter>
          <key>minimumLineCoverageRatio</key>
          <value>85</value> <!-- 85% minimum line coverage -->
        </parameter>
      </parameters>
    </rule>

    <!-- Duplication Rules -->
    <rule>
      <repositoryKey>common-java</repositoryKey>
      <key>DuplicatedBlocks</key>
      <priority>MAJOR</priority>
      <parameters>
        <parameter>
          <key>threshold</key>
          <value>3</value> <!-- Max 3% duplication -->
        </parameter>
      </parameters>
    </rule>

    <!-- Security Rules -->
    <rule>
      <repositoryKey>javasecurity</repositoryKey>
      <key>S2076</key> <!-- SQL Injection -->
      <priority>BLOCKER</priority>
    </rule>
    <rule>
      <repositoryKey>javasecurity</repositoryKey>
      <key>S5131</key> <!-- XSS Vulnerability -->
      <priority>BLOCKER</priority>
    </rule>
  </rules>
</profile>
```

**Backend Quality Configuration (Gradle):**

`services/*/build.gradle`:
```gradle
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.1'
    id 'io.spring.dependency-management' version '1.1.4'
    id 'jacoco'
    id 'checkstyle'
    id 'pmd'
    id 'com.github.spotbugs' version '5.2.1'
    id 'org.sonarqube' version '4.4.1.3373'
    id 'info.solidsoft.pitest' version '1.15.0'
}

// JaCoCo Coverage Configuration
jacoco {
    toolVersion = "0.8.11"
}

jacocoTestReport {
    reports {
        xml.required = true
        html.required = true
        csv.required = false
    }

    afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.collect {
            fileTree(dir: it, exclude: [
                '**/config/**',
                '**/dto/**',
                '**/entity/**',
                '**/*Application.class'
            ])
        }))
    }
}

// Coverage Verification
jacocoTestCoverageVerification {
    violationRules {
        rule {
            limit {
                minimum = 0.85 // 85% overall minimum
            }
        }
        rule {
            element = 'CLASS'
            limit {
                counter = 'LINE'
                value = 'COVEREDRATIO'
                minimum = 0.80
            }
            excludes = [
                '*.config.*',
                '*.dto.*',
                '*.entity.*'
            ]
        }
        rule {
            element = 'CLASS'
            includes = ['*.service.*', '*.domain.*']
            limit {
                counter = 'LINE'
                value = 'COVEREDRATIO'
                minimum = 0.90 // 90% for business logic
            }
        }
    }
}

// Checkstyle Configuration
checkstyle {
    toolVersion = '10.12.5'
    configFile = file("${rootDir}/config/checkstyle/checkstyle.xml")
    maxWarnings = 0
    maxErrors = 0
}

// PMD Configuration
pmd {
    toolVersion = '6.55.0'
    consoleOutput = true
    ruleSetFiles = files("${rootDir}/config/pmd/pmd-ruleset.xml")
    ruleSets = []
}

// SpotBugs Configuration
spotbugs {
    toolVersion = '4.8.2'
    effort = 'max'
    reportLevel = 'low'
    excludeFilter = file("${rootDir}/config/spotbugs/spotbugs-exclude.xml")
}

// Mutation Testing (PITest)
pitest {
    targetClasses = ['ch.batbern.*.service.*', 'ch.batbern.*.domain.*']
    targetTests = ['ch.batbern.*.*Test']
    mutators = ['STRONGER']
    outputFormats = ['XML', 'HTML']
    timestampedReports = false
    mutationThreshold = 80 // 80% minimum mutation score
    coverageThreshold = 85 // 85% minimum coverage
}

// SonarQube Configuration
sonar {
    properties {
        property "sonar.projectKey", "batbern-${project.name}"
        property "sonar.projectName", "BATbern ${project.name}"
        property "sonar.host.url", System.getenv("SONAR_HOST_URL") ?: "http://localhost:9000"
        property "sonar.token", System.getenv("SONAR_TOKEN") ?: ""

        // Coverage
        property "sonar.coverage.jacoco.xmlReportPaths", "${buildDir}/reports/jacoco/test/jacocoTestReport.xml"

        // Quality Gates
        property "sonar.qualitygate.wait", "true"

        // Java-specific
        property "sonar.java.coveragePlugin", "jacoco"
        property "sonar.java.checkstyle.reportPaths", "${buildDir}/reports/checkstyle/main.xml"
        property "sonar.java.pmd.reportPaths", "${buildDir}/reports/pmd/main.xml"
        property "sonar.java.spotbugs.reportPaths", "${buildDir}/reports/spotbugs/main.xml"
    }
}

// Task Dependencies
test.finalizedBy jacocoTestReport
check.dependsOn jacocoTestCoverageVerification
build.dependsOn check

// Custom task to run all quality checks
tasks.register('qualityCheck') {
    dependsOn check, pitest, sonar
    description = 'Runs all quality checks including tests, coverage, static analysis, and mutation testing'
}
```

**Frontend Quality Configuration:**

`web-frontend/.eslintrc.js`:
```javascript
module.exports = {
  root: true,
  parser: '@typescript-eslint/parser',
  parserOptions: {
    ecmaVersion: 2022,
    sourceType: 'module',
    ecmaFeatures: {
      jsx: true
    },
    project: './tsconfig.json'
  },
  extends: [
    'eslint:recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:@typescript-eslint/recommended-requiring-type-checking',
    'plugin:react/recommended',
    'plugin:react-hooks/recommended',
    'plugin:jsx-a11y/recommended',
    'prettier'
  ],
  plugins: [
    '@typescript-eslint',
    'react',
    'react-hooks',
    'jsx-a11y',
    'sonarjs',
    'security'
  ],
  rules: {
    // Complexity
    'complexity': ['error', { max: 15 }],
    'max-lines-per-function': ['warn', { max: 50, skipBlankLines: true, skipComments: true }],
    'max-depth': ['error', 4],
    'max-nested-callbacks': ['error', 3],

    // SonarJS Quality Rules
    'sonarjs/cognitive-complexity': ['error', 15],
    'sonarjs/no-duplicate-string': ['error', 3],
    'sonarjs/no-identical-functions': 'error',

    // Security
    'security/detect-object-injection': 'warn',
    'security/detect-non-literal-regexp': 'warn',
    'security/detect-unsafe-regex': 'error',

    // TypeScript
    '@typescript-eslint/no-explicit-any': 'error',
    '@typescript-eslint/explicit-function-return-type': 'warn',
    '@typescript-eslint/no-unused-vars': ['error', { argsIgnorePattern: '^_' }],

    // React
    'react/prop-types': 'off', // TypeScript handles this
    'react-hooks/rules-of-hooks': 'error',
    'react-hooks/exhaustive-deps': 'warn'
  },
  settings: {
    react: {
      version: 'detect'
    }
  }
};
```

`web-frontend/vitest.config.ts`:
```typescript
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: './tests/setup.ts',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html', 'lcov'],
      exclude: [
        'node_modules/',
        'tests/',
        '**/*.d.ts',
        '**/*.config.*',
        '**/mockData',
        'src/main.tsx'
      ],
      statements: 85,
      branches: 85,
      functions: 85,
      lines: 85,
      // Higher thresholds for business logic
      perFile: true,
      thresholds: {
        autoUpdate: false,
        lines: 85,
        functions: 85,
        branches: 85,
        statements: 85
      }
    }
  }
});
```

`web-frontend/stryker.conf.json`:
```json
{
  "$schema": "./node_modules/@stryker-mutator/core/schema/stryker-schema.json",
  "packageManager": "npm",
  "reporters": ["html", "clear-text", "progress", "dashboard"],
  "testRunner": "vitest",
  "coverageAnalysis": "perTest",
  "mutate": [
    "src/**/*.ts",
    "src/**/*.tsx",
    "!src/**/*.test.ts",
    "!src/**/*.test.tsx",
    "!src/**/*.d.ts",
    "!src/main.tsx"
  ],
  "thresholds": {
    "high": 80,
    "low": 60,
    "break": 80
  },
  "timeoutMS": 60000,
  "concurrency": 4,
  "incremental": true,
  "incrementalFile": ".stryker-tmp/incremental.json"
}
```

**GitHub Actions Quality Workflows:**

`.github/workflows/quality-gates.yml`:
```yaml
name: Quality Gates

on:
  pull_request:
    branches: [develop, main]
  push:
    branches: [develop, main]

jobs:
  backend-quality:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        service:
          - event-management
          - speaker-coordination
          - partner-analytics
          - attendee-experience
          - company-management

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history for SonarQube

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'
          cache: gradle

      - name: Run tests with coverage
        working-directory: services/${{ matrix.service }}
        run: ./gradlew test jacocoTestReport

      - name: Run quality checks
        working-directory: services/${{ matrix.service }}
        run: |
          ./gradlew checkstyleMain checkstyleTest
          ./gradlew pmdMain pmdTest
          ./gradlew spotbugsMain spotbugsTest

      - name: Verify coverage thresholds
        working-directory: services/${{ matrix.service }}
        run: ./gradlew jacocoTestCoverageVerification

      - name: SonarQube Scan
        working-directory: services/${{ matrix.service }}
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
        run: ./gradlew sonar

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          files: services/${{ matrix.service }}/build/reports/jacoco/test/jacocoTestReport.xml
          flags: ${{ matrix.service }}
          name: ${{ matrix.service }}-coverage

  frontend-quality:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: web-frontend/package-lock.json

      - name: Install dependencies
        working-directory: web-frontend
        run: npm ci

      - name: Run linter
        working-directory: web-frontend
        run: npm run lint

      - name: Check formatting
        working-directory: web-frontend
        run: npm run format:check

      - name: Run tests with coverage
        working-directory: web-frontend
        run: npm run test:coverage

      - name: Check bundle size
        working-directory: web-frontend
        run: npm run build && npm run size-limit

      - name: SonarQube Scan
        working-directory: web-frontend
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
        run: |
          npx sonar-scanner \
            -Dsonar.projectKey=batbern-frontend \
            -Dsonar.sources=src \
            -Dsonar.tests=tests \
            -Dsonar.javascript.lcov.reportPaths=coverage/lcov.info

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          files: web-frontend/coverage/lcov.info
          flags: frontend
          name: frontend-coverage

  mutation-testing:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'

    steps:
      - uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: web-frontend/package-lock.json

      - name: Install dependencies
        working-directory: web-frontend
        run: npm ci

      - name: Run Stryker mutation testing
        working-directory: web-frontend
        run: npm run test:mutation

      - name: Upload mutation report
        uses: actions/upload-artifact@v3
        with:
          name: mutation-report
          path: web-frontend/reports/mutation

  coverage-report:
    runs-on: ubuntu-latest
    needs: [backend-quality, frontend-quality]
    if: github.event_name == 'pull_request'

    steps:
      - uses: actions/checkout@v4

      - name: Download coverage reports
        uses: actions/download-artifact@v3

      - name: Calculate coverage delta
        run: |
          chmod +x .github/scripts/check-coverage-delta.sh
          ./.github/scripts/check-coverage-delta.sh

      - name: Comment PR with coverage
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const report = fs.readFileSync('coverage-report.md', 'utf8');

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: report
            });
```

`.github/scripts/check-coverage-delta.sh`:
```bash
#!/bin/bash

echo "# Coverage Report" > coverage-report.md
echo "" >> coverage-report.md

# Calculate overall coverage
CURRENT_COVERAGE=$(cat web-frontend/coverage/coverage-summary.json | jq '.total.lines.pct')
BASELINE_COVERAGE=$(cat .coverage-baseline.json | jq '.frontend.lines.pct')

# Calculate delta
DELTA=$(echo "$CURRENT_COVERAGE - $BASELINE_COVERAGE" | bc)

echo "## Frontend Coverage" >> coverage-report.md
echo "- **Current**: ${CURRENT_COVERAGE}%" >> coverage-report.md
echo "- **Baseline**: ${BASELINE_COVERAGE}%" >> coverage-report.md
echo "- **Delta**: ${DELTA}%" >> coverage-report.md
echo "" >> coverage-report.md

# Check if coverage decreased
if (( $(echo "$DELTA < 0" | bc -l) )); then
    echo "‚ö†Ô∏è **Warning**: Coverage decreased by ${DELTA}%!" >> coverage-report.md
    echo "New code must maintain or improve coverage." >> coverage-report.md
    exit 1
else
    echo "‚úÖ Coverage maintained or improved!" >> coverage-report.md
fi

# Similar checks for backend services...
```

**Branch Protection Configuration:**

`.github/branch-protection.json`:
```json
{
  "branch": "main",
  "protection": {
    "required_status_checks": {
      "strict": true,
      "contexts": [
        "backend-quality (event-management)",
        "backend-quality (speaker-coordination)",
        "backend-quality (partner-analytics)",
        "backend-quality (attendee-experience)",
        "backend-quality (company-management)",
        "frontend-quality",
        "coverage-report",
        "sonarqube/quality-gate"
      ]
    },
    "enforce_admins": true,
    "required_pull_request_reviews": {
      "dismissal_restrictions": {},
      "dismiss_stale_reviews": true,
      "require_code_owner_reviews": true,
      "required_approving_review_count": 2
    },
    "restrictions": null,
    "required_linear_history": true,
    "allow_force_pushes": false,
    "allow_deletions": false
  }
}
```

**CODEOWNERS File:**

`.github/CODEOWNERS`:
```
# Default owners for everything
* @batbern/core-team

# Architecture and infrastructure
/infrastructure/ @batbern/platform-team @batbern/tech-leads
/docs/architecture/ @batbern/tech-leads

# Shared kernel
/shared-kernel/ @batbern/tech-leads

# Domain services
/services/event-management/ @batbern/event-domain-team
/services/speaker-coordination/ @batbern/speaker-domain-team
/services/partner-analytics/ @batbern/partner-domain-team
/services/attendee-experience/ @batbern/attendee-domain-team
/services/company-management/ @batbern/core-team

# Frontend
/web-frontend/ @batbern/frontend-team

# Quality and CI/CD
/.github/ @batbern/platform-team
/sonarqube/ @batbern/platform-team
```

### API Contracts

N/A - Infrastructure story with no direct API contracts.

### Testing Requirements

**Quality Gate Tests:**
- Verify SonarQube quality gate blocks merge when thresholds not met
- Test coverage enforcement prevents <90% coverage commits
- Validate complexity checks fail on methods >15 complexity
- Confirm duplication detection blocks >3% duplication
- Verify security scanning blocks critical vulnerabilities

**Mutation Testing:**
- PITest generates mutation reports for Java services
- Stryker executes mutation testing for frontend
- Mutation score >80% enforced before merge
- Mutation survivors reported in PR comments

**CI/CD Integration:**
- All quality checks run automatically on PR
- Failed quality gates prevent merge
- Coverage reports posted as PR comments
- SonarQube analysis visible in PR status checks

## Definition of Done Checklist

### Development Complete
- [ ] All tests written BEFORE implementation (TDD followed)
- [ ] All acceptance criteria have corresponding tests
- [ ] All acceptance criteria implemented
- [ ] Unit tests written and passing (>90% coverage for quality infrastructure)
- [ ] Integration tests cover CI/CD scenarios (>80% coverage)
- [ ] E2E tests pass for complete quality workflow
- [ ] Configuration files follow project conventions
- [ ] All quality tools properly configured
- [ ] Documentation complete for all quality gates

### Infrastructure Complete ‚ö†Ô∏è CRITICAL
- [ ] SonarQube server deployed and operational
- [ ] Quality profiles configured for Java and TypeScript
- [ ] Coverage thresholds enforced (90% business logic, 85% overall)
- [ ] Complexity limits configured (cyclomatic complexity <15)
- [ ] Duplication detection active (<3% threshold)
- [ ] Security scanning integrated (no critical vulnerabilities)
- [ ] Mutation testing configured (>80% mutation score)
- [ ] Branch protection rules active on main/develop

### Operational Complete
- [ ] All developers have IDE quality integrations installed
- [ ] Team trained on quality tools and workflows
- [ ] Quality dashboards accessible to all team members
- [ ] Coverage baselines established for all services
- [ ] Mutation testing runs on schedule
- [ ] Quality metrics tracked and trending
- [ ] Alert rules configured for quality degradation
- [ ] Support process for quality tool issues

### Review Ready
- [ ] PR created with detailed description
- [ ] Infrastructure review completed
- [ ] Security review passed (quality tool configurations)
- [ ] Documentation reviewed and approved
- [ ] CLAUDE.md updated if quality commands added
- [ ] Training materials distributed to team
- [ ] Team feedback incorporated
- [ ] Quality metrics baseline documented

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-02 | 1.0 | Initial story creation | Scrum Master Bob |

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent during implementation_

### Implementation Approach
_To be documented by dev agent with actual approach taken_

### Debug Log References
_To be populated with debug log references during development_

### Completion Notes
_To be filled with issues encountered and resolutions_

### Files Changed
_To be populated with list of created, modified, and deleted files_

### Deployment Notes
_Special deployment considerations for quality infrastructure setup_

## QA Results
_To be populated by QA Agent after implementation review_
