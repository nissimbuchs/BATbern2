# Story 1.15a.2: Partners API Consolidation

## Status
Approved

## Story

**As a** partner company representative,
**I want** consolidated Partner APIs with flexible analytics and voting capabilities,
**so that** I can access all partner data efficiently in a single request.

## Domain Context

### Primary Domain
Partner Analytics Domain - Partner ROI tracking, employee analytics, topic voting, meeting coordination

### Involved Services
- Partner Analytics Service (primary)
- API Gateway (routing, middleware)
- Shared Kernel (query utilities from Story 1.15a)
- EventBridge (analytics events)

### Cross-Domain Dependencies
- **Depends on**: Story 1.15a (API Consolidation Foundation)
- **Depends on**: Story 1.15a.1 (Events API) for event attendance data
- **Integrates with**: Company Management Service for partner company data

## Requirements Context

### Related Functional Requirements
- **FR4**: Partner access to company-specific analytics
- **FR26**: Topic voting and strategic input
- **FR28**: Partner meeting coordination

### Acceptance Criteria Source
API Consolidation Analysis (docs/api-consolidation-analysis.md), Section 3.2 - Partners Domain

## Architecture Context

### Architecture Patterns
[Source: docs/api-consolidation-analysis.md]
- **Before**: 109 endpoints
- **After**: 20 endpoints
- **Reduction**: 82%
- **Analytics Consolidation**: `?metrics=attendance,employees,engagement&timeframe=year`
- **Batch Voting**: PATCH with array of votes

## Wireframe Context

### Wireframe References
- `story-6.1-partner-analytics-dashboard.md`
- `story-6.2-partner-meetings.md`
- `story-6.3-partner-directory.md`
- `story-6.4-topic-voting.md`

## Acceptance Criteria

1. **List Partners**: `GET /api/v1/partners` with filtering
2. **Get Partner**: `GET /api/v1/partners/{id}?include=analytics,settings,meetings,votes,employees`
3. **Partner CRUD**: POST/PUT/PATCH/DELETE `/api/v1/partners`
4. **Analytics**: `GET /api/v1/partners/{id}/analytics?metrics=attendance,employees,engagement&timeframe=month|quarter|year`
5. **Analytics Export**: `POST /api/v1/partners/{id}/analytics/export`
6. **Meetings List**: `GET /api/v1/partners/{id}/meetings?filter={}&page={}`
7. **Meeting CRUD**: POST/PUT `/api/v1/partners/{id}/meetings/{meetingId}`
8. **Topic Votes**: `GET /api/v1/partners/{id}/topics/votes?sessionId={}`
9. **Batch Voting**: `PUT /api/v1/partners/{id}/topics/votes` with array
10. **Employee Analytics**: `GET /api/v1/partners/{id}/employees?filter={}&page={}`
11. **Notifications**: `GET /api/v1/partners/{id}/notifications`
12. **Reports**: `GET /api/v1/partners/{id}/reports?type=roi|engagement`

## Consolidated Endpoints (20 Total)

```
GET    /api/v1/partners?filter={}&sort={}&page={}
GET    /api/v1/partners/{id}?include=analytics,settings,meetings,votes,employees
POST   /api/v1/partners
PUT    /api/v1/partners/{id}
PATCH  /api/v1/partners/{id}
DELETE /api/v1/partners/{id}

GET    /api/v1/partners/{id}/analytics?metrics={}&timeframe={}
POST   /api/v1/partners/{id}/analytics/export

GET    /api/v1/partners/{id}/meetings?filter={}&page={}
POST   /api/v1/partners/{id}/meetings
PUT    /api/v1/partners/{id}/meetings/{meetingId}

GET    /api/v1/partners/{id}/topics/votes?sessionId={}
PUT    /api/v1/partners/{id}/topics/votes
PATCH  /api/v1/partners/{id}/topics/votes

GET    /api/v1/partners/{id}/employees?filter={}&page={}
GET    /api/v1/partners/{id}/notifications?filter={}
PUT    /api/v1/partners/{id}/notifications/read

POST   /api/v1/partners/{id}/export
GET    /api/v1/partners/{id}/reports?type={}
POST   /api/v1/partners/{id}/reports
```

## Performance Requirements

- Partner detail with analytics: <600ms (P95)
- Analytics query: <400ms (P95)
- Batch vote update: <200ms (P95)

## Definition of Done

- [ ] All 12 ACs implemented
- [ ] 109 â†’ 20 endpoints consolidation verified
- [ ] 4 wireframes migrated
- [ ] Analytics endpoint with flexible metrics
- [ ] Batch voting operational
- [ ] Tests >90% coverage

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-10-04 | 1.0 | Partners API consolidation | Winston (Architect) |
